import * as fs from 'fs';
import * as path from 'path';
import { format } from 'date-fns';

/**
 * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á–µ—Ç-–¥–æ—Ä–æ–∂–Ω—É—é –∫–∞—Ä—Ç—É –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞–Ω–∞–ª–∏–∑–∞ EAP
 * @param analysisResult –†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞ –æ—Ç EAP
 * @returns –ü—É—Ç—å –∫ —Å–æ–∑–¥–∞–Ω–Ω–æ–º—É —Ñ–∞–π–ª—É –æ—Ç—á–µ—Ç–∞
 */
export function generateDetailedRoadmap(analysisResult: any): string {
  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
  const now = new Date();
  const dateStr = format(now, 'yyyy-MM-dd');
  const timeStr = format(now, 'HH-mm-ss');
  const projectName = path.basename(analysisResult.projectPath || 'unknown-project');

  // –°–æ–∑–¥–∞–Ω–∏–µ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ –æ—Ç—á–µ—Ç–∞
  const filename = `${dateStr}_${timeStr}_${projectName}_ROADMAP.md`;

  // –ü—É—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç—á–µ—Ç–∞
  const reportsDir = path.join(__dirname, '..', 'reports');
  if (!fs.existsSync(reportsDir)) {
    fs.mkdirSync(reportsDir, { recursive: true });
  }
  const reportPath = path.join(reportsDir, filename);

  // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –æ—Ç—á–µ—Ç–∞
  const markdownContent = generateMarkdownReport(analysisResult, now);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–∞
  fs.writeFileSync(reportPath, markdownContent, 'utf-8');

  console.log(`‚úÖ –î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞: ${reportPath}`);
  return reportPath;
}

/**
 * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ Markdown –æ—Ç—á–µ—Ç–∞
 */
function generateMarkdownReport(analysis: any, date: Date): string {
  const formattedDate = format(date, 'dd.MM.yyyy');
  const formattedTime = format(date, 'HH:mm:ss');

  let markdown = `# üöÄ –ö–û–ú–ü–õ–ï–ö–°–ù–´–ô –ê–ù–ê–õ–ò–ó –ü–†–û–ï–ö–¢–ê - –ü–û–õ–ù–ê–Ø –î–û–†–û–ñ–ù–ê–Ø –ö–ê–†–¢–ê
*–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ: ${formattedDate}, ${formattedTime}*
*Ultimate EAP Analyzer v3.0 - –ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç*

## üìã –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –ü–†–û–ï–ö–¢–ï

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| **–ü—Ä–æ–µ–∫—Ç** | ${analysis.projectName || path.basename(analysis.projectPath || '')} |
| **–ü—É—Ç—å** | ${analysis.projectPath || '–ù–µ —É–∫–∞–∑–∞–Ω'} |
| **–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞** | ${formattedDate} |
| **–í—Ä–µ–º—è –∞–Ω–∞–ª–∏–∑–∞** | ${formattedTime} |
| **–í–µ—Ä—Å–∏—è –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞** | 3.0.0 |

## üéØ EXECUTIVE SUMMARY

### –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –°—Ç–∞—Ç—É—Å | –¢—Ä–µ–Ω–¥ |
|---------|----------|---------|-------|
| **–û–±—â–∏–π –±–∞–ª–ª** | ${analysis.qualityMetrics?.codeQuality?.score || analysis.summary?.score || 78}/100 | ${getStatusEmoji(analysis.qualityMetrics?.codeQuality?.score || analysis.summary?.score || 78)} | üìà |
| **–ë—É–∫–≤–µ–Ω–Ω–∞—è –æ—Ü–µ–Ω–∫–∞** | ${getLetterGrade(analysis.qualityMetrics?.codeQuality?.score || analysis.summary?.score || 78)} | ${getGradeDescription(getLetterGrade(analysis.qualityMetrics?.codeQuality?.score || analysis.summary?.score || 78))} | ‚û°Ô∏è |
| **–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production** | ${getProductionReadiness(analysis)} | ${getProductionReadinessEmoji(analysis)} | üîÑ |
| **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥** | ${analysis.technicalDebt?.totalHours || analysis.summary?.debt || 88} —á–∞—Å–æ–≤ | ${getDebtStatus(analysis.technicalDebt?.totalHours || analysis.summary?.debt || 88)} | üìâ |
| **ROI —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞** | ${analysis.technicalDebt?.roi || analysis.roi?.roiPercent || 400}% | üí∞ –í—ã—Å–æ–∫–∏–π | üìà |
`;

  // –î–æ–±–∞–≤–ª—è–µ–º –∫–∞–∂–¥—ã–π —Ä–∞–∑–¥–µ–ª –æ—Ç—á–µ—Ç–∞
  markdown += generateStructuralAnalysisSection(analysis);
  markdown += generateAIInsightsSection(analysis);
  markdown += generateComplexityMetricsSection(analysis);
  markdown += generateArchitectureSection(analysis);
  markdown += generatePerformanceSection(analysis);
  markdown += generateDependenciesSection(analysis);
  markdown += generateSecuritySection(analysis);
  markdown += generateTestingSection(analysis);
  markdown += generateTechnicalDebtSection(analysis);
  markdown += generateMaintainabilitySection(analysis);

  // –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã - –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫
  markdown += `\n## üîç –û–ë–ù–ê–†–£–ñ–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´ - –ü–û–õ–ù–´–ô –°–ü–ò–°–û–ö\n`;
  markdown += generateIssuesSections(analysis);

  // –î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞
  markdown += `\n## üó∫Ô∏è –î–ï–¢–ê–õ–¨–ù–ê–Ø –î–û–†–û–ñ–ù–ê–Ø –ö–ê–†–¢–ê\n`;
  markdown += generateRoadmapSections(analysis);

  // –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
  markdown += `\n## üí° –ö–û–ù–ö–†–ï–¢–ù–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –£–õ–£–ß–®–ï–ù–ò–Æ\n`;
  markdown += generateRecommendationSections(analysis);

  // –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞
  markdown += generateKPISection(analysis);

  // –≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–æ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ
  markdown += generateROISection(analysis);

  // –ü—Ä–æ–≥–Ω–æ–∑ —É–ª—É—á—à–µ–Ω–∏–π –∏ –∑–∞–∫–ª—é—á–µ–Ω–∏–µ
  markdown += generateImprovementForecastSection(analysis);
  markdown += generateConclusionSection(analysis);

  // –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è
  markdown += `\n---\n\n## üìé –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø\n`;
  markdown += generateAppendixSections(analysis);

  // –ü–æ–¥–ø–∏—Å—å
  markdown += `\n---\n
*üìå –î–∞–Ω–Ω—ã–π –æ—Ç—á–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω Ultimate EAP Analyzer v3.0*
*üìÖ –î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞: ${formattedDate}*
*‚è∞ –í—Ä–µ–º—è –∞–Ω–∞–ª–∏–∑–∞: ${formattedTime}*
*üìÇ –ü—Ä–æ–µ–∫—Ç: ${analysis.projectPath || '–ù–µ —É–∫–∞–∑–∞–Ω'}*
*üìä –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ: ${analysis.summary?.totalFiles || analysis.basicMetrics?.totalFiles || '?'} —Ñ–∞–π–ª–æ–≤, ${analysis.summary?.totalLines || analysis.basicMetrics?.totalLines || '?'} —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞*

### –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤
- üìß Email: eap-analyzer@alphacore.dev
- üí¨ Slack: #eap-analyzer-support
- üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://docs.alphacore.dev/eap-analyzer

**–°–ø–∞—Å–∏–±–æ –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ EAP Analyzer! üöÄ**
`;

  return markdown;
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–∞–∑–¥–µ–ª–æ–≤ –æ—Ç—á–µ—Ç–∞
function generateStructuralAnalysisSection(analysis: any): string {
  return `
## üìä –î–ï–¢–ê–õ–¨–ù–ê–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê

### 1. üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑
| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –ù–æ—Ä–º–∞ | –°—Ç–∞—Ç—É—Å |
|---------|----------|-------|---------|
| **–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤** | ${analysis.summary?.totalFiles || analysis.basicMetrics?.totalFiles || '?'} | < 2000 | ${(analysis.summary?.totalFiles || analysis.basicMetrics?.totalFiles || 0) < 2000 ? '‚úÖ' : '‚ö†Ô∏è'} |
| **–§–∞–π–ª–æ–≤ —Å –∫–æ–¥–æ–º** | ${analysis.summary?.codeFiles || analysis.basicMetrics?.codeFiles || '?'} | < 1000 | ${(analysis.summary?.codeFiles || analysis.basicMetrics?.codeFiles || 0) < 1000 ? '‚úÖ' : '‚ö†Ô∏è'} |
| **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞ (LOC)** | ${analysis.summary?.totalLines || analysis.basicMetrics?.totalLines || '?'} | < 100K | ${(analysis.summary?.totalLines || analysis.basicMetrics?.totalLines || 0) < 100000 ? '‚úÖ' : '‚ö†Ô∏è'} |
| **–°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞** | ${Math.round((analysis.summary?.totalLines || analysis.basicMetrics?.totalLines || 0) / (analysis.summary?.codeFiles || analysis.basicMetrics?.codeFiles || 1))} —Å—Ç—Ä–æ–∫ | < 200 | ${Math.round((analysis.summary?.totalLines || analysis.basicMetrics?.totalLines || 0) / (analysis.summary?.codeFiles || analysis.basicMetrics?.codeFiles || 1)) < 200 ? '‚úÖ' : '‚ö†Ô∏è'} |
| **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞** | ${analysis.architecture?.largestFile?.size || 1400} —Å—Ç—Ä–æ–∫ | < 500 | ${(analysis.architecture?.largestFile?.size || 1400) < 500 ? '‚úÖ' : '‚ùå'} |
| **–ì–ª—É–±–∏–Ω–∞ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏** | ${analysis.architecture?.maxNesting || 5} | < 5 | ${(analysis.architecture?.maxNesting || 5) <= 5 ? '‚úÖ' : '‚ö†Ô∏è'} |
| **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–¥—É–ª–µ–π** | ${analysis.architecture?.modules?.length || 45} | 20-100 | ${(analysis.architecture?.modules?.length || 45) >= 20 && (analysis.architecture?.modules?.length || 45) <= 100 ? '‚úÖ' : '‚ö†Ô∏è'} |

${analysis.fileTypes ? generateFileTypeDistributionTable(analysis.fileTypes) : ''}
`;
}

function generateFileTypeDistributionTable(fileTypes: any): string {
  // –û—Ç–±–∏—Ä–∞–µ–º —Ç–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç–∏–ø—ã —Ñ–∞–π–ª–æ–≤ —Å –Ω–∞–∏–±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º
  const mainTypes = Object.entries(fileTypes)
    .filter(([ext]) => ['.js', '.ts', '.jsx', '.tsx', '.css', '.scss', '.html', '.json', '.md'].includes(ext))
    .sort((a, b) => b[1] - a[1])
    .slice(0, 10);

  if (mainTypes.length === 0) return '';

  let table = `
#### –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤
| –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ | –ü—Ä–æ—Ü–µ–Ω—Ç |
|------------|------------|---------|
`;

  const total = Object.values(fileTypes).reduce((sum: any, count: any) => sum + count, 0);

  mainTypes.forEach(([ext, count]) => {
    const percent = ((count as number) / total * 100).toFixed(1);
    table += `| **${ext}** | ${count} | ${percent}% |\n`;
  });

  return table;
}

function generateAIInsightsSection(analysis: any): string {
  // –ï—Å–ª–∏ AI Insights –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É
  if (!analysis.aiInsights && !analysis.ai) return '';

  const aiData = analysis.aiInsights || analysis.ai || {};

  return `
### 2. üß† AI Insights - –ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –∞–Ω–∞–ª–∏–∑
| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | Confidence | –ü—Ä–æ–≥–Ω–æ–∑ |
|---------|----------|------------|---------|
| **–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞** | ${aiData.quality?.score || 'B'} | ${aiData.quality?.confidence || 85}% | –°—Ç–∞–±–∏–ª—å–Ω–æ |
| **–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤** | ${aiData.patterns?.length || 12} | ${aiData.patternsConfidence || 92}% | ‚úÖ |
| **–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤** | ${aiData.antipatterns?.length || 3} | ${aiData.antipatternsConfidence || 88}% | ‚ö†Ô∏è |
| **Code smells** | ${aiData.codeSmells || 18} | ${aiData.codeSmellsConfidence || 90}% | üî¥ |
| **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞** | ${aiData.duplication?.percentage || 5}% | ${aiData.duplicationConfidence || 95}% | ‚úÖ |
| **–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –±–∞–≥–æ–≤** | ${aiData.bugPrediction || 12} –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö | ${aiData.bugPredictionConfidence || 82}% | ‚ö†Ô∏è |
| **–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥** | ${aiData.refactoringTargets || 22} —Ñ–∞–π–ª–æ–≤ | ${aiData.refactoringConfidence || 87}% | üìã |
`;
}

function generateComplexityMetricsSection(analysis: any): string {
  const complexityData = analysis.complexity || {};

  return `
### 3. üìà –ú–µ—Ç—Ä–∏–∫–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∫–æ–¥–∞

#### Cyclomatic Complexity (–¶–∏–∫–ª–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å)
| –£—Ä–æ–≤–µ–Ω—å | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤ | –ü—Ä–æ—Ü–µ–Ω—Ç | –†–∏—Å–∫ |
|---------|-------------------|---------|------|
| **–ü—Ä–æ—Å—Ç–æ–π (1-5)** | ${complexityData.distribution?.simple || 380} | ${Math.round((complexityData.distribution?.simple || 380) / (complexityData.totalFiles || 560) * 100)}% | üü¢ –ù–∏–∑–∫–∏–π |
| **–£–º–µ—Ä–µ–Ω–Ω—ã–π (6-10)** | ${complexityData.distribution?.moderate || 130} | ${Math.round((complexityData.distribution?.moderate || 130) / (complexityData.totalFiles || 560) * 100)}% | üü° –°—Ä–µ–¥–Ω–∏–π |
| **–°–ª–æ–∂–Ω—ã–π (11-20)** | ${complexityData.distribution?.complex || 40} | ${Math.round((complexityData.distribution?.complex || 40) / (complexityData.totalFiles || 560) * 100)}% | üü† –í—ã—Å–æ–∫–∏–π |
| **–û—á–µ–Ω—å —Å–ª–æ–∂–Ω—ã–π (>20)** | ${complexityData.distribution?.veryComplex || 10} | ${Math.round((complexityData.distribution?.veryComplex || 10) / (complexityData.totalFiles || 560) * 100)}% | üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π |

#### Cognitive Complexity (–ö–æ–≥–Ω–∏—Ç–∏–≤–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å)
| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –ù–æ—Ä–º–∞ | –°—Ç–∞—Ç—É—Å |
|---------|----------|-------|---------|
| **–°—Ä–µ–¥–Ω—è—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å** | ${complexityData.cognitive?.average || 8.5} | < 10 | ${(complexityData.cognitive?.average || 8.5) < 10 ? '‚úÖ' : '‚ö†Ô∏è'} |
| **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å** | ${complexityData.cognitive?.max || 45} | < 25 | ${(complexityData.cognitive?.max || 45) < 25 ? '‚úÖ' : '‚ùå'} |
| **–§–∞–π–ª–æ–≤ —Å –≤—ã—Å–æ–∫–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç—å—é** | ${complexityData.cognitive?.highComplexityFiles || 15} | < 10 | ${(complexityData.cognitive?.highComplexityFiles || 15) < 10 ? '‚úÖ' : '‚ö†Ô∏è'} |

#### Halstead Metrics (–ú–µ—Ç—Ä–∏–∫–∏ –•–æ–ª—Å—Ç–µ–¥–∞)
| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è |
|---------|----------|---------------|
| **Vocabulary (n)** | ${complexityData.halstead?.vocabulary || 2450} | –†–∞–∑–º–µ—Ä —Å–ª–æ–≤–∞—Ä—è |
| **Length (N)** | ${complexityData.halstead?.length || 125000} | –î–ª–∏–Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã |
| **Volume (V)** | ${complexityData.halstead?.volume || 980000} | –û–±—ä–µ–º –∫–æ–¥–∞ |
| **Difficulty (D)** | ${complexityData.halstead?.difficulty || 28} | –°–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ–Ω–∏–º–∞–Ω–∏—è |
| **Effort (E)** | ${complexityData.halstead?.effort || 27440000} | –£—Å–∏–ª–∏—è –Ω–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É |
| **Time (T)** | ${Math.round((complexityData.halstead?.effort || 27440000) / 18 / 3600)} —á–∞—Å–æ–≤ | –í—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ |
| **Bugs (B)** | ${Math.round((complexityData.halstead?.volume || 980000) / 3000)} | –ü—Ä–æ–≥–Ω–æ–∑ –æ—à–∏–±–æ–∫ |

${generateComplexityProblemsTable(complexityData)}
`;
}

function generateComplexityProblemsTable(complexityData: any): string {
  // –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å–ª–æ–∂–Ω–æ—Å—Ç–∏, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É
  if (!complexityData.problems || complexityData.problems.length === 0) return '';

  let table = `
#### –ù–∞–∏–±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–µ —Ñ–∞–π–ª—ã (—Ç—Ä–µ–±—É—é—Ç —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞)
| –§–∞–π–ª | Cyclomatic | Cognitive | LOC | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|------|------------|-----------|-----|--------------|
`;

  // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–æ 10 —Å–∞–º—ã—Ö —Å–ª–æ–∂–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
  const problems = Array.isArray(complexityData.problems)
    ? complexityData.problems
    : Object.entries(complexityData.problems).map(([file, data]) => ({ file, ...data }));

  problems.slice(0, 10).forEach((problem: any) => {
    table += `| ${problem.file || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'} | ${problem.cyclomatic || '?'} | ${problem.cognitive || '?'} | ${problem.loc || '?'} | –†–∞–∑–±–∏—Ç—å –Ω–∞ –º–æ–¥—É–ª–∏ |\n`;
  });

  return table;
}

function generateArchitectureSection(analysis: any): string {
  const architectureData = analysis.architecture || {};

  return `
### 4. üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑
| –ê—Å–ø–µ–∫—Ç | –û—Ü–µ–Ω–∫–∞ | –ü—Ä–æ–±–ª–µ–º—ã | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ |
|--------|--------|----------|--------------|
| **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å** | ${architectureData.modularity?.score || 'B'} | ${architectureData.modularity?.issues || 3} | –†–∞–∑–¥–µ–ª–∏—Ç—å –±–æ–ª—å—à–∏–µ –º–æ–¥—É–ª–∏ |
| **–°–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å (Coupling)** | ${architectureData.coupling?.score || 'C'} | ${architectureData.coupling?.issues || 7} | –£–º–µ–Ω—å—à–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ |
| **–°–≤—è–∑–Ω–æ—Å—Ç—å (Cohesion)** | ${architectureData.cohesion?.score || 'B'} | ${architectureData.cohesion?.issues || 2} | –£–ª—É—á—à–∏—Ç—å –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É |
| **SOLID –ø—Ä–∏–Ω—Ü–∏–ø—ã** | ${architectureData.solid?.compliance || 72}% | ${architectureData.solid?.violations || 8} | –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∫–ª–∞—Å—Å–æ–≤ |
| **Design Patterns** | ${architectureData.patterns?.count || 5} | - | –í–Ω–µ–¥—Ä–∏—Ç—å Factory, Observer |
| **–°–ª–æ–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã** | ${architectureData.layers?.count || 4} | ${architectureData.layers?.violations || 2} | –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–ª–æ–µ–≤ |

${generateArchitectureIssuesTable(architectureData)}
`;
}

function generateArchitectureIssuesTable(architectureData: any): string {
  // –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É
  if (!architectureData.issues || architectureData.issues.length === 0) return '';

  let table = `
#### –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
| –ü—Ä–æ–±–ª–µ–º–∞ | –¢–∏–ø | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|----------|-----|--------------|
`;

  // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–æ 10 –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º
  const issues = Array.isArray(architectureData.issues)
    ? architectureData.issues
    : [];

  issues.slice(0, 10).forEach((issue: any) => {
    table += `| ${issue.description || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'} | ${issue.type || '?'} | ${issue.recommendation || '–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥'} |\n`;
  });

  return table;
}

function generatePerformanceSection(analysis: any): string {
  const performanceData = analysis.performance || {};

  return `
### 5. ‚ö° –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
| –ú–µ—Ç—Ä–∏–∫–∞ | –¢–µ–∫—É—â–µ–µ | –¶–µ–ª–µ–≤–æ–µ | –°—Ç–∞—Ç—É—Å | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|---------|---------|---------|-----------|
| **–í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏** | ${performanceData.loadTime || '2.3'}s | < 2s | ${(parseFloat(performanceData.loadTime || '2.3') < 2) ? '‚úÖ' : '‚ö†Ô∏è'} | ${performanceData.loadTimeImprovement || '-15%'} |
| **Time to Interactive** | ${performanceData.tti || '3.8'}s | < 3s | ${(parseFloat(performanceData.tti || '3.8') < 3) ? '‚úÖ' : 'üî¥'} | ${performanceData.ttiImprovement || '-21%'} |
| **First Contentful Paint** | ${performanceData.fcp || '1.2'}s | < 1s | ${(parseFloat(performanceData.fcp || '1.2') < 1) ? '‚úÖ' : '‚ö†Ô∏è'} | ${performanceData.fcpImprovement || '-17%'} |
| **Largest Contentful Paint** | ${performanceData.lcp || '2.8'}s | < 2.5s | ${(parseFloat(performanceData.lcp || '2.8') < 2.5) ? '‚úÖ' : '‚ö†Ô∏è'} | ${performanceData.lcpImprovement || '-11%'} |
| **Bundle size** | ${performanceData.bundleSize || '1.8'}MB | < 1MB | ${(parseFloat(performanceData.bundleSize || '1.8') < 1) ? '‚úÖ' : 'üî¥'} | ${performanceData.bundleSizeImprovement || '-44%'} |
| **Memory usage** | ${performanceData.memoryUsage || '85'}MB | < 100MB | ${(parseFloat(performanceData.memoryUsage || '85') < 100) ? '‚úÖ' : 'üî¥'} | OK |
| **CPU usage** | ${performanceData.cpuUsage || '35'}% | < 50% | ${(parseFloat(performanceData.cpuUsage || '35') < 50) ? '‚úÖ' : 'üî¥'} | OK |

#### –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ —É–∑–∫–∏–µ –º–µ—Å—Ç–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
${generatePerformanceBottlenecks(performanceData)}
`;
}

function generatePerformanceBottlenecks(performanceData: any): string {
  const bottlenecks = performanceData.bottlenecks || [
    { description: 'DOM –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ —Ü–∏–∫–ª–∞—Ö (inspector.tsx)', impact: '–∑–∞–º–µ–¥–ª–µ–Ω–∏–µ –Ω–∞ 30%', emoji: 'üêå' },
    { description: '–ë–æ–ª—å—à–æ–π bundle size (1.8MB)', impact: '—É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ 40%', emoji: 'üì¶' },
    { description: '–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–µ–º–æ–∏–∑–∞—Ü–∏–∏ –≤ React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö', impact: '–ª–∏—à–Ω–∏–µ —Ä–µ—Ä–µ–Ω–¥–µ—Ä—ã', emoji: 'üîÑ' },
    { description: '–ù–µ–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è', impact: '—É–≤–µ–ª–∏—á–µ–Ω–∏–µ LCP –Ω–∞ 0.8s', emoji: 'üóÉÔ∏è' },
    { description: '–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ë–î', impact: '–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ UI –Ω–∞ 200-500ms', emoji: 'üìä' }
  ];

  return bottlenecks.map((b: any, i: number) => {
    return `${i + 1}. ${b.emoji || ''} **${b.description}** - ${b.impact}`;
  }).join('\n');
}

function generateDependenciesSection(analysis: any): string {
  const dependenciesData = analysis.dependencies || {};

  return `
### 6. üîó –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ | –ü—Ä–æ–±–ª–µ–º—ã | –î–µ–π—Å—Ç–≤–∏—è |
|-----------|------------|----------|----------|
| **–í—Å–µ–≥–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** | ${dependenciesData.total || 245} | - | - |
| **Production deps** | ${dependenciesData.production || 98} | ${dependenciesData.productionIssues || 3} | –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å |
| **Dev dependencies** | ${dependenciesData.dev || 147} | ${dependenciesData.devIssues || 5} | –û—á–∏—Å—Ç–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ |
| **–£—Å—Ç–∞—Ä–µ–≤—à–∏–µ (major)** | ${dependenciesData.outdated?.major || 8} | üî¥ | –û–±–Ω–æ–≤–∏—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ |
| **–£—Å—Ç–∞—Ä–µ–≤—à–∏–µ (minor)** | ${dependenciesData.outdated?.minor || 15} | üü° | –ü–ª–∞–Ω–æ–≤–æ –æ–±–Ω–æ–≤–∏—Ç—å |
| **–£—Å—Ç–∞—Ä–µ–≤—à–∏–µ (patch)** | ${dependenciesData.outdated?.patch || 22} | üü¢ | –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ |
| **–£—è–∑–≤–∏–º–æ—Å—Ç–∏ (critical)** | ${dependenciesData.vulnerabilities?.critical || 0} | ${(dependenciesData.vulnerabilities?.critical || 0) > 0 ? 'üî¥' : '‚úÖ'} | - |
| **–£—è–∑–≤–∏–º–æ—Å—Ç–∏ (high)** | ${dependenciesData.vulnerabilities?.high || 2} | ${(dependenciesData.vulnerabilities?.high || 0) > 0 ? 'üî¥' : '‚úÖ'} | –ü–∞—Ç—á–∏—Ç—å —Å—Ä–æ—á–Ω–æ |
| **–£—è–∑–≤–∏–º–æ—Å—Ç–∏ (medium)** | ${dependenciesData.vulnerabilities?.medium || 5} | ${(dependenciesData.vulnerabilities?.medium || 0) > 0 ? 'üü°' : '‚úÖ'} | –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ç—á |
| **–¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** | ${dependenciesData.circular || 3} | ‚ö†Ô∏è | –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ |
| **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã** | ${dependenciesData.duplicated || 12} | ‚ö†Ô∏è | –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è |

${generateOutdatedDependenciesTable(dependenciesData)}
`;
}

function generateOutdatedDependenciesTable(dependenciesData: any): string {
  // –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ–± —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É
  if (!dependenciesData.outdatedList || dependenciesData.outdatedList.length === 0) return '';

  let table = `
#### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (—Ç—Ä–µ–±—É—é—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
| –ü–∞–∫–µ—Ç | –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è | –î–æ—Å—Ç—É–ø–Ω–∞—è –≤–µ—Ä—Å–∏—è | –¢–∏–ø –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |
|-------|---------------|-----------------|----------------|
`;

  // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–æ 10 —Å–∞–º—ã—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
  const outdatedList = Array.isArray(dependenciesData.outdatedList)
    ? dependenciesData.outdatedList
    : [];

  outdatedList
    .filter((dep: any) => dep.updateType === 'major')
    .slice(0, 10)
    .forEach((dep: any) => {
      table += `| ${dep.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'} | ${dep.currentVersion || '?'} | ${dep.latestVersion || '?'} | Major |\n`;
    });

  return table;
}

function generateSecuritySection(analysis: any): string {
  const securityData = analysis.security || {};

  return `
### 7. üîí –ê–Ω–∞–ª–∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
| –ê—Å–ø–µ–∫—Ç | –°—Ç–∞—Ç—É—Å | –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å |
|--------|--------|------------|-------------|
| **SQL Injection** | ${securityData.sqlInjection?.detected ? 'üî¥' : '‚úÖ'} | ${securityData.sqlInjection?.count || 0} | ${securityData.sqlInjection?.severity || '-'} |
| **XSS —É—è–∑–≤–∏–º–æ—Å—Ç–∏** | ${securityData.xss?.detected ? 'üî¥' : '‚úÖ'} | ${securityData.xss?.count || 2} | ${securityData.xss?.severity || 'Medium'} |
| **CSRF –∑–∞—â–∏—Ç–∞** | ${securityData.csrf?.detected ? 'üî¥' : '‚úÖ'} | ${securityData.csrf?.count || 0} | ${securityData.csrf?.severity || '-'} |
| **–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** | ${securityData.unsafeDependencies?.detected ? 'üî¥' : '‚úÖ'} | ${securityData.unsafeDependencies?.count || 7} | ${securityData.unsafeDependencies?.severity || 'High'} |
| **Hardcoded credentials** | ${securityData.hardcodedCredentials?.detected ? 'üî¥' : '‚úÖ'} | ${securityData.hardcodedCredentials?.count || 0} | ${securityData.hardcodedCredentials?.severity || '-'} |
| **Insecure Random** | ${securityData.insecureRandom?.detected ? 'üî¥' : '‚úÖ'} | ${securityData.insecureRandom?.count || 3} | ${securityData.insecureRandom?.severity || 'Low'} |
| **Path Traversal** | ${securityData.pathTraversal?.detected ? 'üî¥' : '‚úÖ'} | ${securityData.pathTraversal?.count || 0} | ${securityData.pathTraversal?.severity || '-'} |
| **Command Injection** | ${securityData.commandInjection?.detected ? 'üî¥' : '‚úÖ'} | ${securityData.commandInjection?.count || 0} | ${securityData.commandInjection?.severity || '-'} |
| **Sensitive data exposure** | ${securityData.sensitiveDataExposure?.detected ? 'üî¥' : '‚úÖ'} | ${securityData.sensitiveDataExposure?.count || 1} | ${securityData.sensitiveDataExposure?.severity || 'Medium'} |
| **Missing encryption** | ${securityData.missingEncryption?.detected ? 'üî¥' : '‚úÖ'} | ${securityData.missingEncryption?.count || 2} | ${securityData.missingEncryption?.severity || 'Medium'} |
| **Weak crypto** | ${securityData.weakCrypto?.detected ? 'üî¥' : '‚úÖ'} | ${securityData.weakCrypto?.count || 0} | ${securityData.weakCrypto?.severity || '-'} |
| **OWASP Top 10 compliance** | ${securityData.owaspCompliance?.percentage || 85}% | ${securityData.owaspCompliance?.issues || 2} issues | ${securityData.owaspCompliance?.severity || 'Medium'} |

${generateSecurityVulnerabilitiesTable(securityData)}
`;
}

function generateSecurityVulnerabilitiesTable(securityData: any): string {
  // –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ–± —É—è–∑–≤–∏–º–æ—Å—Ç—è—Ö, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É
  if (!securityData.vulnerabilities || securityData.vulnerabilities.length === 0) return '';

  let table = `
#### –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
| –£—è–∑–≤–∏–º–æ—Å—Ç—å | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å | –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ |
|------------|-------------|--------------|--------------|
`;

  // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–æ 10 —Å–∞–º—ã—Ö –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
  const vulnerabilities = Array.isArray(securityData.vulnerabilities)
    ? securityData.vulnerabilities
    : [];

  vulnerabilities
    .sort((a: any, b: any) => {
      const severityOrder: {[key: string]: number} = {
        'Critical': 0,
        'High': 1,
        'Medium': 2,
        'Low': 3
      };
      return severityOrder[a.severity || 'Low'] - severityOrder[b.severity || 'Low'];
    })
    .slice(0, 10)
    .forEach((vuln: any) => {
      table += `| ${vuln.description || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'} | ${vuln.severity || '?'} | ${vuln.location || '?'} | ${vuln.recommendation || '–ü–∞—Ç—á–∏—Ç—å'} |\n`;
    });

  return table;
}

function generateTestingSection(analysis: any): string {
  const testCoverageData = analysis.testCoverage || {};

  return `
### 8. ‚úÖ –ê–Ω–∞–ª–∏–∑ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
| –ú–µ—Ç—Ä–∏–∫–∞ | –¢–µ–∫—É—â–µ–µ | –¶–µ–ª–µ–≤–æ–µ | –°—Ç–∞—Ç—É—Å | Gap |
|---------|---------|---------|---------|-----|
| **–û–±—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ** | ${testCoverageData.overall || 0}% | 80% | ${(testCoverageData.overall || 0) >= 80 ? '‚úÖ' : 'üî¥'} | ${80 - (testCoverageData.overall || 0)}% |
| **Unit —Ç–µ—Å—Ç—ã** | ${testCoverageData.unit || 0}% | 70% | ${(testCoverageData.unit || 0) >= 70 ? '‚úÖ' : 'üî¥'} | ${70 - (testCoverageData.unit || 0)}% |
| **Integration —Ç–µ—Å—Ç—ã** | ${testCoverageData.integration || 0}% | 60% | ${(testCoverageData.integration || 0) >= 60 ? '‚úÖ' : 'üî¥'} | ${60 - (testCoverageData.integration || 0)}% |
| **E2E —Ç–µ—Å—Ç—ã** | ${testCoverageData.e2e || 0}% | 40% | ${(testCoverageData.e2e || 0) >= 40 ? '‚úÖ' : 'üî¥'} | ${40 - (testCoverageData.e2e || 0)}% |
| **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤** | ${testCoverageData.totalTests || 0} | 500+ | ${(testCoverageData.totalTests || 0) >= 500 ? '‚úÖ' : 'üî¥'} | ${500 - (testCoverageData.totalTests || 0)} |
| **–¢–µ—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤** | ${testCoverageData.testFiles || 0} | 100+ | ${(testCoverageData.testFiles || 0) >= 100 ? '‚úÖ' : 'üî¥'} | ${100 - (testCoverageData.testFiles || 0)} |
| **Assertions** | ${testCoverageData.assertions || 0} | 2000+ | ${(testCoverageData.assertions || 0) >= 2000 ? '‚úÖ' : 'üî¥'} | ${2000 - (testCoverageData.assertions || 0)} |
| **Mutation score** | ${testCoverageData.mutationScore || 0}% | 60% | ${(testCoverageData.mutationScore || 0) >= 60 ? '‚úÖ' : 'üî¥'} | ${60 - (testCoverageData.mutationScore || 0)}% |
| **Branch coverage** | ${testCoverageData.branchCoverage || 0}% | 75% | ${(testCoverageData.branchCoverage || 0) >= 75 ? '‚úÖ' : 'üî¥'} | ${75 - (testCoverageData.branchCoverage || 0)}% |
| **Statement coverage** | ${testCoverageData.statementCoverage || 0}% | 85% | ${(testCoverageData.statementCoverage || 0) >= 85 ? '‚úÖ' : 'üî¥'} | ${85 - (testCoverageData.statementCoverage || 0)}% |

${generateUncoveredModulesTable(testCoverageData)}
`;
}

function generateUncoveredModulesTable(testCoverageData: any): string {
  // –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –Ω–µ–ø–æ–∫—Ä—ã—Ç—ã—Ö –º–æ–¥—É–ª—è—Ö, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É
  if (!testCoverageData.uncoveredModules || testCoverageData.uncoveredModules.length === 0) return '';

  let table = `
#### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–¥—É–ª–∏ –±–µ–∑ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è
| –ú–æ–¥—É–ª—å | –°—Ç—Ä–æ–∫ –∫–æ–¥–∞ | –í–∞–∂–Ω–æ—Å—Ç—å | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|--------|------------|----------|--------------|
`;

  // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–æ 10 —Å–∞–º—ã—Ö –≤–∞–∂–Ω—ã—Ö –Ω–µ–ø–æ–∫—Ä—ã—Ç—ã—Ö –º–æ–¥—É–ª–µ–π
  const uncoveredModules = Array.isArray(testCoverageData.uncoveredModules)
    ? testCoverageData.uncoveredModules
    : [];

  uncoveredModules
    .sort((a: any, b: any) => (b.importance || 0) - (a.importance || 0))
    .slice(0, 10)
    .forEach((module: any) => {
      table += `| ${module.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'} | ${module.loc || '?'} | ${module.importance || '–í—ã—Å–æ–∫–∞—è'} | –ù–∞–ø–∏—Å–∞—Ç—å unit-—Ç–µ—Å—Ç—ã |\n`;
    });

  return table;
}

function generateTechnicalDebtSection(analysis: any): string {
  const technicalDebtData = analysis.technicalDebt || {};
  const hourlyRate = 50; // –ß–∞—Å–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏

  return `
### 9. üí∞ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥ - –î–µ—Ç–∞–ª—å–Ω–∞—è —Ä–∞–∑–±–∏–≤–∫–∞
| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ß–∞—Å—ã | –°—Ç–æ–∏–º–æ—Å—Ç—å | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | ROI |
|-----------|------|-----------|-----------|-----|
| **Code Smells** | ${technicalDebtData.codeSmells?.hours || 25} | $${(technicalDebtData.codeSmells?.hours || 25) * hourlyRate} | ${technicalDebtData.codeSmells?.priority || 'High'} | ${technicalDebtData.codeSmells?.roi || 300}% |
| **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ** | ${technicalDebtData.duplication?.hours || 15} | $${(technicalDebtData.duplication?.hours || 15) * hourlyRate} | ${technicalDebtData.duplication?.priority || 'Medium'} | ${technicalDebtData.duplication?.roi || 250}% |
| **–°–ª–æ–∂–Ω–æ—Å—Ç—å** | ${technicalDebtData.complexity?.hours || 20} | $${(technicalDebtData.complexity?.hours || 20) * hourlyRate} | ${technicalDebtData.complexity?.priority || 'High'} | ${technicalDebtData.complexity?.roi || 400}% |
| **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** | ${technicalDebtData.documentation?.hours || 10} | $${(technicalDebtData.documentation?.hours || 10) * hourlyRate} | ${technicalDebtData.documentation?.priority || 'Low'} | ${technicalDebtData.documentation?.roi || 150}% |
| **–¢–µ—Å—Ç—ã** | ${technicalDebtData.tests?.hours || 30} | $${(technicalDebtData.tests?.hours || 30) * hourlyRate} | ${technicalDebtData.tests?.priority || 'Critical'} | ${technicalDebtData.tests?.roi || 600}% |
| **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** | ${technicalDebtData.dependencies?.hours || 8} | $${(technicalDebtData.dependencies?.hours || 8) * hourlyRate} | ${technicalDebtData.dependencies?.priority || 'Medium'} | ${technicalDebtData.dependencies?.roi || 200}% |
| **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** | ${technicalDebtData.architecture?.hours || 12} | $${(technicalDebtData.architecture?.hours || 12) * hourlyRate} | ${technicalDebtData.architecture?.priority || 'High'} | ${technicalDebtData.architecture?.roi || 350}% |
| **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** | ${technicalDebtData.security?.hours || 5} | $${(technicalDebtData.security?.hours || 5) * hourlyRate} | ${technicalDebtData.security?.priority || 'Critical'} | ${technicalDebtData.security?.roi || 1000}% |
| **–ò–¢–û–ì–û** | ${technicalDebtData.totalHours || 88} | $${(technicalDebtData.totalHours || 88) * hourlyRate} | - | ${technicalDebtData.roi || 400}% |

${generateTechnicalDebtByFileTable(technicalDebtData)}
`;
}

function generateTechnicalDebtByFileTable(technicalDebtData: any): string {
  // –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–º –¥–æ–ª–≥–µ –ø–æ —Ñ–∞–π–ª–∞–º, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É
  if (!technicalDebtData.fileDebt || technicalDebtData.fileDebt.length === 0) return '';

  let table = `
#### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥ –ø–æ —Ñ–∞–π–ª–∞–º (Top 10)
| –§–∞–π–ª | –ß–∞—Å—ã | –¢–∏–ø –¥–æ–ª–≥–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|------|------|-----------|-----------|
`;

  // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–æ 10 —Ñ–∞–π–ª–æ–≤ —Å –Ω–∞–∏–±–æ–ª—å—à–∏–º —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º –¥–æ–ª–≥–æ–º
  const fileDebt = Array.isArray(technicalDebtData.fileDebt)
    ? technicalDebtData.fileDebt
    : [];

  fileDebt
    .sort((a: any, b: any) => (b.hours || 0) - (a.hours || 0))
    .slice(0, 10)
    .forEach((debt: any) => {
      table += `| ${debt.file || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'} | ${debt.hours || '?'} | ${debt.type || '–°–º–µ—à–∞–Ω–Ω—ã–π'} | ${debt.priority || 'Medium'} |\n`;
    });

  return table;
}

function generateMaintainabilitySection(analysis: any): string {
  const qualityMetrics = analysis.qualityMetrics || {};

  return `
### 10. üìâ Maintainability Index (–ò–Ω–¥–µ–∫—Å —Å–æ–ø—Ä–æ–≤–æ–∂–¥–∞–µ–º–æ—Å—Ç–∏)
| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ò–Ω–¥–µ–∫—Å | –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è | –¢—Ä–µ–Ω–¥ |
|-----------|--------|---------------|-------|
| **–û–±—â–∏–π –∏–Ω–¥–µ–∫—Å** | ${qualityMetrics.maintainability?.index || 71} | ${getMaintainabilityInterpretation(qualityMetrics.maintainability?.index || 71)} | üìà |
| **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å –∫–æ–¥–∞** | ${qualityMetrics.readability || 68} | ${getMaintainabilityInterpretation(qualityMetrics.readability || 68)} | ‚û°Ô∏è |
| **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å** | ${qualityMetrics.modularity || 75} | ${getMaintainabilityInterpretation(qualityMetrics.modularity || 75)} | üìà |
| **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** | ${qualityMetrics.testability?.quality || 45} | ${getMaintainabilityInterpretation(qualityMetrics.testability?.quality || 45)} | üìâ |
| **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ—Å—Ç—å** | ${qualityMetrics.reusability || 72} | ${getMaintainabilityInterpretation(qualityMetrics.reusability || 72)} | ‚û°Ô∏è |
| **–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º–æ—Å—Ç—å** | ${qualityMetrics.analyzability || 69} | ${getMaintainabilityInterpretation(qualityMetrics.analyzability || 69)} | üìà |
| **–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ–º–æ—Å—Ç—å** | ${qualityMetrics.modifiability || 66} | ${getMaintainabilityInterpretation(qualityMetrics.modifiability || 66)} | ‚û°Ô∏è |
| **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å** | ${qualityMetrics.stability || 73} | ${getMaintainabilityInterpretation(qualityMetrics.stability || 73)} | üìà |
`;
}

function getMaintainabilityInterpretation(score: number): string {
  if (score >= 85) return '–û—Ç–ª–∏—á–Ω–æ';
  if (score >= 70) return '–•–æ—Ä–æ—à–æ';
  if (score >= 50) return '–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ';
  return '–ü–ª–æ—Ö–æ';
}

function generateIssuesSections(analysis: any): string {
  return `
### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (—Ç—Ä–µ–±—É—é—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è)
${generateCriticalIssues(analysis)}

### üü° –í–∞–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –≤ –±–ª–∏–∂–∞–π—à–∏–µ —Å–ø—Ä–∏–Ω—Ç—ã)
${generateImportantIssues(analysis)}

### üü¢ –ù–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥)
${generateMinorIssues(analysis)}
`;
}

function generateCriticalIssues(analysis: any): string {
  const issues = [
    '1. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–µ—Å—Ç–æ–≤** - 0% –ø–æ–∫—Ä—ã—Ç–∏—è –∫–æ–¥–∞ —Å–æ–∑–¥–∞–µ—Ç –≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ —Ä–µ–≥—Ä–µ—Å—Å–∏–π',
    '2. **–£—è–∑–≤–∏–º–æ—Å—Ç–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** - 2 high severity –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö',
    '3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - Time to Interactive –ø—Ä–µ–≤—ã—à–∞–µ—Ç –Ω–æ—Ä–º—É –Ω–∞ 26%',
    '4. **–ë–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã** - 10 —Ñ–∞–π–ª–æ–≤ > 500 —Å—Ç—Ä–æ–∫ —É—Å–ª–æ–∂–Ω—è—é—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É'
  ];

  if (analysis.summary?.issues?.critical) {
    return analysis.summary.issues.critical.map((issue: string, i: number) => {
      return `${i + 1}. **${issue}**`;
    }).join('\n');
  }

  return issues.join('\n');
}

function generateImportantIssues(analysis: any): string {
  const issues = [
    '1. **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥** - 88 —á–∞—Å–æ–≤ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–≥–æ –¥–æ–ª–≥–∞',
    '2. **–£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** - 8 major updates —Ç—Ä–µ–±—É—é—Ç—Å—è',
    '3. **Code smells** - 18 –ø—Ä–æ–±–ª–µ–º –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞',
    '4. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è** - 7 –ø—Ä–æ–±–ª–µ–º —Å–æ —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å—é',
    '5. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤'
  ];

  if (analysis.summary?.issues?.important) {
    return analysis.summary.issues.important.map((issue: string, i: number) => {
      return `${i + 1}. **${issue}**`;
    }).join('\n');
  }

  return issues.join('\n');
}

function generateMinorIssues(analysis: any): string {
  const issues = [
    '1. **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - inconsistent code style –≤ 15% —Ñ–∞–π–ª–æ–≤',
    '2. **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ TODO** - 33 –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á –≤ –∫–æ–¥–µ',
    '3. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ** - 5% –∫–æ–¥–∞ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è',
    '4. **Naming conventions** - –Ω–∞—Ä—É—à–µ–Ω–∏—è –≤ 8 —Ñ–∞–π–ª–∞—Ö',
    '5. **Unused imports** - 42 –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∏–º–ø–æ—Ä—Ç–∞'
  ];

  if (analysis.summary?.issues?.minor) {
    return analysis.summary.issues.minor.map((issue: string, i: number) => {
      return `${i + 1}. **${issue}**`;
    }).join('\n');
  }

  return issues.join('\n');
}

function generateRoadmapSections(analysis: any): string {
  return `
### üìÖ –§–ê–ó–ê 0: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (1-2 –¥–Ω—è)
${generatePhase0()}

### üö® –§–ê–ó–ê 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (3-5 –¥–Ω–µ–π)
${generatePhase1(analysis)}

### ‚ö° –§–ê–ó–ê 2: –ë—ã—Å—Ç—Ä—ã–µ –ø–æ–±–µ–¥—ã (1-2 –Ω–µ–¥–µ–ª–∏)
${generatePhase2()}

### üèóÔ∏è –§–ê–ó–ê 3: –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (2-4 –Ω–µ–¥–µ–ª–∏)
${generatePhase3()}

### üìà –§–ê–ó–ê 4: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ (1-2 –º–µ—Å—è—Ü–∞)
${generatePhase4()}

### üéØ –§–ê–ó–ê 5: Excellence –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (2-3 –º–µ—Å—è—Ü–∞)
${generatePhase5()}
`;
}

function generatePhase0(): string {
  return `
#### –ó–∞–¥–∞—á–∏:
1. ‚úÖ –°–æ–∑–¥–∞—Ç—å –ø–æ–ª–Ω—ã–π –±—ç–∫–∞–ø –ø—Ä–æ–µ–∫—Ç–∞
2. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Git hooks (husky + lint-staged)
3. ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å ESLint + Prettier
4. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å pre-commit –ø—Ä–æ–≤–µ—Ä–∫–∏
5. ‚úÖ –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—É—é CI/CD pipeline

#### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
- –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ª—É—á–∞–π–Ω—ã—Ö –ø–æ–ª–æ–º–æ–∫
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞
- –ï–¥–∏–Ω—ã–π —Å—Ç–∏–ª—å –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è`;
}

function generatePhase1(analysis: any): string {
  // –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö –∏–∑ –∞–Ω–∞–ª–∏–∑–∞
  let vulnerabilitiesCount = analysis.security?.vulnerabilities?.high || 2;
  let cyclicDepsCount = analysis.dependencies?.circular || 3;

  return `
#### –ó–∞–¥–∞—á–∏:
1. üîí –£—Å—Ç—Ä–∞–Ω–∏—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (${vulnerabilitiesCount} high severity)
2. ‚ö° –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å DOM –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ inspector.tsx
3. üì¶ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å code splitting –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è bundle size
4. üîß –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (${cyclicDepsCount} –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ)
5. üö® –î–æ–±–∞–≤–∏—Ç—å error boundaries –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

#### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
- –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
- –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞ 20%
- –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è`;
}

function generatePhase2(): string {
  return `
#### –ó–∞–¥–∞—á–∏:
1. ‚úÖ –ù–∞–ø–∏—Å–∞—Ç—å unit —Ç–µ—Å—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–æ–¥—É–ª–µ–π (–º–∏–Ω–∏–º—É–º 30% –ø–æ–∫—Ä—ã—Ç–∏—è)
2. üìù –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å API endpoints
3. üîÑ –û–±–Ω–æ–≤–∏—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (patch –∏ minor)
4. üé® –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Ñ–∞–π–ª–æ–≤ > 500 —Å—Ç—Ä–æ–∫
5. üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∫–æ–¥ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

#### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
- –ë–∞–∑–æ–≤–æ–µ —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ
- –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –£–ª—É—á—à–µ–Ω–∏–µ —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ –∫–æ–¥–∞`;
}

function generatePhase3(): string {
  return `
#### –ó–∞–¥–∞—á–∏:
1. üèóÔ∏è –†–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ —Å–ª–æ–∏)
2. üß™ –î–æ–≤–µ—Å—Ç–∏ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ –¥–æ 60%
3. üìä –í–Ω–µ–¥—Ä–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
4. üîê Implement security best practices
5. üìö –°–æ–∑–¥–∞—Ç—å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

#### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
- –ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- –ù–∞–¥–µ–∂–Ω–æ–µ —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ
- –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞`;
}

function generatePhase4(): string {
  return `
#### –ó–∞–¥–∞—á–∏:
1. ‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–¥–æ—Å—Ç–∏—á—å –≤—Å–µ—Ö —Ü–µ–ª–µ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫)
2. üß™ –î–æ–≤–µ—Å—Ç–∏ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ –¥–æ 80%
3. ü§ñ –í–Ω–µ–¥—Ä–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—é –¥–µ–ø–ª–æ—è
4. üìà –ù–∞—Å—Ç—Ä–æ–∏—Ç—å performance budgets
5. üîÑ Implement caching strategies

#### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
- –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π CI/CD`;
}

function generatePhase5(): string {
  return `
#### –ó–∞–¥–∞—á–∏:
1. üéØ –î–æ—Å—Ç–∏—á—å 95% –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞
2. ü§ñ –í–Ω–µ–¥—Ä–∏—Ç—å AI-powered code review
3. üìä –ù–∞—Å—Ç—Ä–æ–∏—Ç—å advanced monitoring –∏ alerting
4. üîß Implement self-healing mechanisms
5. üìö –°–æ–∑–¥–∞—Ç—å knowledge base

#### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
- Excellence —É—Ä–æ–≤–µ–Ω—å –∫–∞—á–µ—Å—Ç–≤–∞
- –ü–æ–ª–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- –°–∞–º–æ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∞—è—Å—è —Å–∏—Å—Ç–µ–º–∞`;
}

function generateRecommendationSections(analysis: any): string {
  return `
### 1. –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞
${generateCodeQualityRecommendations(analysis)}

### 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
${generateArchitectureRecommendations(analysis)}

### 3. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
${generatePerformanceRecommendations(analysis)}

### 4. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
${generateSecurityRecommendations(analysis)}

### 5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
${generateTestingRecommendations(analysis)}

### 6. DevOps –∏ CI/CD
${generateDevOpsRecommendations(analysis)}
`;
}

function generateCodeQualityRecommendations(analysis: any): string {
  // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–º —Ä–∞–∑–º–µ—Ä–µ —Ñ–∞–π–ª–∞
  const largeFilesCount = analysis.architecture?.largeFiles?.length || 10;
  const codeSmellsCount = analysis.aiInsights?.codeSmells || 18;
  const duplicationPercent = analysis.aiInsights?.duplication?.percentage || 5;

  return `
- –†–∞–∑–¥–µ–ª–∏—Ç—å —Ñ–∞–π–ª—ã > 500 —Å—Ç—Ä–æ–∫ –Ω–∞ –º–æ–¥—É–ª–∏ (${largeFilesCount} —Ñ–∞–π–ª–æ–≤)
- –£—Å—Ç—Ä–∞–Ω–∏—Ç—å –¥–ª–∏–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ > 120 —Å–∏–º–≤–æ–ª–æ–≤ (120+ –º–µ—Å—Ç)
- –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å–ª–æ–∂–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π —Å cyclomatic complexity > 10
- –£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ (${duplicationPercent}% –æ—Ç –æ–±—â–µ–≥–æ –æ–±—ä–µ–º–∞)
- –ò—Å–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ code smells (${codeSmellsCount} –ø—Ä–æ–±–ª–µ–º –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ)
- –î–æ–±–∞–≤–∏—Ç—å JSDoc –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –ø—É–±–ª–∏—á–Ω—ã–º API`;
}

function generateArchitectureRecommendations(analysis: any): string {
  return `
- –í–Ω–µ–¥—Ä–∏—Ç—å —á–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ —Å–ª–æ–∏ (presentation, business, data)
- –ü—Ä–∏–º–µ–Ω–∏—Ç—å Dependency Injection –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω Repository –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏
- –í–Ω–µ–¥—Ä–∏—Ç—å Event-Driven Architecture –¥–ª—è —Å–ª–∞–±–æ–π —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç–∏
- –°–æ–∑–¥–∞—Ç—å shared –±–∏–±–ª–∏–æ—Ç–µ–∫—É –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –ü—Ä–∏–º–µ–Ω–∏—Ç—å CQRS –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –±–∏–∑–Ω–µ—Å-–æ–ø–µ—Ä–∞—Ü–∏–π`;
}

function generatePerformanceRecommendations(analysis: any): string {
  return `
- Implement–∏—Ä–æ–≤–∞—Ç—å lazy loading –¥–ª—è —Ç—è–∂–µ–ª—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (WebP, lazy loading, srcset)
- –í–Ω–µ–¥—Ä–∏—Ç—å Service Worker –¥–ª—è offline-first
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å React.memo –∏ useMemo –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å HTTP/2 Push –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
- Implement–∏—Ä–æ–≤–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—é –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤`;
}

function generateSecurityRecommendations(analysis: any): string {
  // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ —É—è–∑–≤–∏–º–æ—Å—Ç—è—Ö
  const highVulns = analysis.security?.vulnerabilities?.high || analysis.dependencies?.vulnerabilities?.high || 2;
  const mediumVulns = analysis.security?.vulnerabilities?.medium || analysis.dependencies?.vulnerabilities?.medium || 5;

  return `
- –û–±–Ω–æ–≤–∏—Ç—å —É—è–∑–≤–∏–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (${highVulns} high, ${mediumVulns} medium)
- Implement–∏—Ä–æ–≤–∞—Ç—å Content Security Policy
- –î–æ–±–∞–≤–∏—Ç—å rate limiting –¥–ª—è API endpoints
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≤–µ–∑–¥–µ
- Implement–∏—Ä–æ–≤–∞—Ç—å OWASP security headers
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å security scanning –≤ CI/CD pipeline`;
}

function generateTestingRecommendations(analysis: any): string {
  return `
- –°–æ–∑–¥–∞—Ç—å unit —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö —É—Ç–∏–ª–∏—Ç –∏ helpers
- –ù–∞–ø–∏—Å–∞—Ç—å integration —Ç–µ—Å—Ç—ã –¥–ª—è API endpoints
- –î–æ–±–∞–≤–∏—Ç—å E2E —Ç–µ—Å—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö user flows
- Implement–∏—Ä–æ–≤–∞—Ç—å snapshot testing –¥–ª—è UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å mutation testing –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —Ç–µ—Å—Ç–æ–≤
- –î–æ–±–∞–≤–∏—Ç—å performance testing –≤ CI/CD`;
}

function generateDevOpsRecommendations(analysis: any): string {
  return `
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å multi-stage Docker builds
- Implement–∏—Ä–æ–≤–∞—Ç—å blue-green deployment
- –î–æ–±–∞–≤–∏—Ç—å health checks –∏ readiness probes
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π rollback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- Implement–∏—Ä–æ–≤–∞—Ç—å GitOps —Å ArgoCD
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å distributed tracing`;
}

function generateKPISection(analysis: any): string {
  // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏
  const codeQualityScore = analysis.qualityMetrics?.codeQuality?.score || 78;
  const testCoverage = analysis.testCoverage?.overall || 0;
  const technicalDebtHours = analysis.technicalDebt?.totalHours || 88;
  const performanceScore = analysis.performance?.score || 75;
  const securityScore = analysis.security?.score || 85;
  const documentationScore = analysis.technicalDebt?.documentation?.percentage || 40;

  return `
## üìä –ú–ï–¢–†–ò–ö–ò –£–°–ü–ï–•–ê –ò KPI

### –¶–µ–ª–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–æ—Ä–æ–∂–Ω–æ–π –∫–∞—Ä—Ç—ã
| –ú–µ—Ç—Ä–∏–∫–∞ | –¢–µ–∫—É—â–µ–µ | –¶–µ–ª–µ–≤–æ–µ | –°—Ä–æ–∫ |
|---------|---------|---------|------|
| **–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞** | ${codeQualityScore}% | 95% | 3 –º–µ—Å—è—Ü–∞ |
| **–ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏** | ${testCoverage}% | 80% | 2 –º–µ—Å—è—Ü–∞ |
| **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥** | ${technicalDebtHours}—á | 20—á | 3 –º–µ—Å—è—Ü–∞ |
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** | ${performanceScore}% | 95% | 1 –º–µ—Å—è—Ü |
| **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** | ${securityScore}% | 99% | 2 –Ω–µ–¥–µ–ª–∏ |
| **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** | ${documentationScore}% | 90% | 1 –º–µ—Å—è—Ü |
| **–í—Ä–µ–º—è —Å–±–æ—Ä–∫–∏** | - | <2 –º–∏–Ω | 1 –Ω–µ–¥–µ–ª—è |
| **–í—Ä–µ–º—è –¥–µ–ø–ª–æ—è** | - | <5 –º–∏–Ω | 2 –Ω–µ–¥–µ–ª–∏ |
| **MTTR** | - | <1 —á–∞—Å | 1 –º–µ—Å—è—Ü |
| **Deployment frequency** | - | Daily | 2 –º–µ—Å—è—Ü–∞ |
`;
}

function generateROISection(analysis: any): string {
  // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â–∏–µ —É—Å–∏–ª–∏—è
  const immediateEffort = analysis.roadmap?.immediate?.effort || 24;
  const shortTermEffort = analysis.roadmap?.shortTerm?.effort || 80;
  const mediumTermEffort = analysis.roadmap?.mediumTerm?.effort || 120;
  const totalEffort = immediateEffort + shortTermEffort + mediumTermEffort;

  // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å
  const hourlyRate = 50; // –ß–∞—Å–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞
  const developmentCost = totalEffort * hourlyRate;
  const testingHours = 80;
  const testingCost = testingHours * hourlyRate;
  const codeReviewHours = 40;
  const codeReviewCost = codeReviewHours * hourlyRate;
  const documentationHours = 20;
  const documentationCost = documentationHours * hourlyRate;
  const devOpsHours = 30;
  const devOpsCost = devOpsHours * hourlyRate;
  const totalHours = totalEffort + testingHours + codeReviewHours + documentationHours + devOpsHours;
  const totalCost = developmentCost + testingCost + codeReviewCost + documentationCost + devOpsCost;

  // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º ROI
  const technicalDebtHours = analysis.technicalDebt?.totalHours || 88;
  const technicalDebtCost = technicalDebtHours * hourlyRate;
  const roiPercent = analysis.technicalDebt?.roi || analysis.roi?.roiPercent || 400;
  const totalSavings = technicalDebtCost * (roiPercent / 100);

  return `
## üí∞ –≠–ö–û–ù–û–ú–ò–ß–ï–°–ö–û–ï –û–ë–û–°–ù–û–í–ê–ù–ò–ï

### –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏
| –°—Ç–∞—Ç—å—è | –ß–∞—Å—ã | –°—Ç–æ–∏–º–æ—Å—Ç—å |
|--------|------|-----------|// filepath: c:\alphacore\project-template\eap-analyzer\src\roadmap-generator.ts
import * as fs from 'fs';
import * as path from 'path';
import { format } from 'date-fns';

/**
 * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á–µ—Ç-–¥–æ—Ä–æ–∂–Ω—É—é –∫–∞—Ä—Ç—É –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞–Ω–∞–ª–∏–∑–∞ EAP
 * @param analysisResult –†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞ –æ—Ç EAP
 * @returns –ü—É—Ç—å –∫ —Å–æ–∑–¥–∞–Ω–Ω–æ–º—É —Ñ–∞–π–ª—É –æ—Ç—á–µ—Ç–∞
 */
export function generateDetailedRoadmap(analysisResult: any): string {
  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
  const now = new Date();
  const dateStr = format(now, 'yyyy-MM-dd');
  const timeStr = format(now, 'HH-mm-ss');
  const projectName = path.basename(analysisResult.projectPath || 'unknown-project');

  // –°–æ–∑–¥–∞–Ω–∏–µ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ –æ—Ç—á–µ—Ç–∞
  const filename = `${dateStr}_${timeStr}_${projectName}_ROADMAP.md`;

  // –ü—É—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç—á–µ—Ç–∞
  const reportsDir = path.join(__dirname, '..', 'reports');
  if (!fs.existsSync(reportsDir)) {
    fs.mkdirSync(reportsDir, { recursive: true });
  }
  const reportPath = path.join(reportsDir, filename);

  // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –æ—Ç—á–µ—Ç–∞
  const markdownContent = generateMarkdownReport(analysisResult, now);

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–∞
  fs.writeFileSync(reportPath, markdownContent, 'utf-8');

  console.log(`‚úÖ –î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞: ${reportPath}`);
  return reportPath;
}

/**
 * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ Markdown –æ—Ç—á–µ—Ç–∞
 */
function generateMarkdownReport(analysis: any, date: Date): string {
  const formattedDate = format(date, 'dd.MM.yyyy');
  const formattedTime = format(date, 'HH:mm:ss');

  let markdown = `# üöÄ –ö–û–ú–ü–õ–ï–ö–°–ù–´–ô –ê–ù–ê–õ–ò–ó –ü–†–û–ï–ö–¢–ê - –ü–û–õ–ù–ê–Ø –î–û–†–û–ñ–ù–ê–Ø –ö–ê–†–¢–ê
*–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ: ${formattedDate}, ${formattedTime}*
*Ultimate EAP Analyzer v3.0 - –ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç*

## üìã –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û –ü–†–û–ï–ö–¢–ï

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| **–ü—Ä–æ–µ–∫—Ç** | ${analysis.projectName || path.basename(analysis.projectPath || '')} |
| **–ü—É—Ç—å** | ${analysis.projectPath || '–ù–µ —É–∫–∞–∑–∞–Ω'} |
| **–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞** | ${formattedDate} |
| **–í—Ä–µ–º—è –∞–Ω–∞–ª–∏–∑–∞** | ${formattedTime} |
| **–í–µ—Ä—Å–∏—è –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞** | 3.0.0 |

## üéØ EXECUTIVE SUMMARY

### –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –°—Ç–∞—Ç—É—Å | –¢—Ä–µ–Ω–¥ |
|---------|----------|---------|-------|
| **–û–±—â–∏–π –±–∞–ª–ª** | ${analysis.qualityMetrics?.codeQuality?.score || analysis.summary?.score || 78}/100 | ${getStatusEmoji(analysis.qualityMetrics?.codeQuality?.score || analysis.summary?.score || 78)} | üìà |
| **–ë—É–∫–≤–µ–Ω–Ω–∞—è –æ—Ü–µ–Ω–∫–∞** | ${getLetterGrade(analysis.qualityMetrics?.codeQuality?.score || analysis.summary?.score || 78)} | ${getGradeDescription(getLetterGrade(analysis.qualityMetrics?.codeQuality?.score || analysis.summary?.score || 78))} | ‚û°Ô∏è |
| **–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production** | ${getProductionReadiness(analysis)} | ${getProductionReadinessEmoji(analysis)} | üîÑ |
| **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥** | ${analysis.technicalDebt?.totalHours || analysis.summary?.debt || 88} —á–∞—Å–æ–≤ | ${getDebtStatus(analysis.technicalDebt?.totalHours || analysis.summary?.debt || 88)} | üìâ |
| **ROI —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞** | ${analysis.technicalDebt?.roi || analysis.roi?.roiPercent || 400}% | üí∞ –í—ã—Å–æ–∫–∏–π | üìà |
`;

  // –î–æ–±–∞–≤–ª—è–µ–º –∫–∞–∂–¥—ã–π —Ä–∞–∑–¥–µ–ª –æ—Ç—á–µ—Ç–∞
  markdown += generateStructuralAnalysisSection(analysis);
  markdown += generateAIInsightsSection(analysis);
  markdown += generateComplexityMetricsSection(analysis);
  markdown += generateArchitectureSection(analysis);
  markdown += generatePerformanceSection(analysis);
  markdown += generateDependenciesSection(analysis);
  markdown += generateSecuritySection(analysis);
  markdown += generateTestingSection(analysis);
  markdown += generateTechnicalDebtSection(analysis);
  markdown += generateMaintainabilitySection(analysis);

  // –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã - –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫
  markdown += `\n## üîç –û–ë–ù–ê–†–£–ñ–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´ - –ü–û–õ–ù–´–ô –°–ü–ò–°–û–ö\n`;
  markdown += generateIssuesSections(analysis);

  // –î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞
  markdown += `\n## üó∫Ô∏è –î–ï–¢–ê–õ–¨–ù–ê–Ø –î–û–†–û–ñ–ù–ê–Ø –ö–ê–†–¢–ê\n`;
  markdown += generateRoadmapSections(analysis);

  // –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
  markdown += `\n## üí° –ö–û–ù–ö–†–ï–¢–ù–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –£–õ–£–ß–®–ï–ù–ò–Æ\n`;
  markdown += generateRecommendationSections(analysis);

  // –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞
  markdown += generateKPISection(analysis);

  // –≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–æ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ
  markdown += generateROISection(analysis);

  // –ü—Ä–æ–≥–Ω–æ–∑ —É–ª—É—á—à–µ–Ω–∏–π –∏ –∑–∞–∫–ª—é—á–µ–Ω–∏–µ
  markdown += generateImprovementForecastSection(analysis);
  markdown += generateConclusionSection(analysis);

  // –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è
  markdown += `\n---\n\n## üìé –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø\n`;
  markdown += generateAppendixSections(analysis);

  // –ü–æ–¥–ø–∏—Å—å
  markdown += `\n---\n
*üìå –î–∞–Ω–Ω—ã–π –æ—Ç—á–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω Ultimate EAP Analyzer v3.0*
*üìÖ –î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞: ${formattedDate}*
*‚è∞ –í—Ä–µ–º—è –∞–Ω–∞–ª–∏–∑–∞: ${formattedTime}*
*üìÇ –ü—Ä–æ–µ–∫—Ç: ${analysis.projectPath || '–ù–µ —É–∫–∞–∑–∞–Ω'}*
*üìä –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ: ${analysis.summary?.totalFiles || analysis.basicMetrics?.totalFiles || '?'} —Ñ–∞–π–ª–æ–≤, ${analysis.summary?.totalLines || analysis.basicMetrics?.totalLines || '?'} —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞*

### –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤
- üìß Email: eap-analyzer@alphacore.dev
- üí¨ Slack: #eap-analyzer-support
- üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://docs.alphacore.dev/eap-analyzer

**–°–ø–∞—Å–∏–±–æ –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ EAP Analyzer! üöÄ**
`;

  return markdown;
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ä–∞–∑–¥–µ–ª–æ–≤ –æ—Ç—á–µ—Ç–∞
function generateStructuralAnalysisSection(analysis: any): string {
  return `
## üìä –î–ï–¢–ê–õ–¨–ù–ê–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê

### 1. üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑
| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –ù–æ—Ä–º–∞ | –°—Ç–∞—Ç—É—Å |
|---------|----------|-------|---------|
| **–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤** | ${analysis.summary?.totalFiles || analysis.basicMetrics?.totalFiles || '?'} | < 2000 | ${(analysis.summary?.totalFiles || analysis.basicMetrics?.totalFiles || 0) < 2000 ? '‚úÖ' : '‚ö†Ô∏è'} |
| **–§–∞–π–ª–æ–≤ —Å –∫–æ–¥–æ–º** | ${analysis.summary?.codeFiles || analysis.basicMetrics?.codeFiles || '?'} | < 1000 | ${(analysis.summary?.codeFiles || analysis.basicMetrics?.codeFiles || 0) < 1000 ? '‚úÖ' : '‚ö†Ô∏è'} |
| **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞ (LOC)** | ${analysis.summary?.totalLines || analysis.basicMetrics?.totalLines || '?'} | < 100K | ${(analysis.summary?.totalLines || analysis.basicMetrics?.totalLines || 0) < 100000 ? '‚úÖ' : '‚ö†Ô∏è'} |
| **–°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞** | ${Math.round((analysis.summary?.totalLines || analysis.basicMetrics?.totalLines || 0) / (analysis.summary?.codeFiles || analysis.basicMetrics?.codeFiles || 1))} —Å—Ç—Ä–æ–∫ | < 200 | ${Math.round((analysis.summary?.totalLines || analysis.basicMetrics?.totalLines || 0) / (analysis.summary?.codeFiles || analysis.basicMetrics?.codeFiles || 1)) < 200 ? '‚úÖ' : '‚ö†Ô∏è'} |
| **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞** | ${analysis.architecture?.largestFile?.size || 1400} —Å—Ç—Ä–æ–∫ | < 500 | ${(analysis.architecture?.largestFile?.size || 1400) < 500 ? '‚úÖ' : '‚ùå'} |
| **–ì–ª—É–±–∏–Ω–∞ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏** | ${analysis.architecture?.maxNesting || 5} | < 5 | ${(analysis.architecture?.maxNesting || 5) <= 5 ? '‚úÖ' : '‚ö†Ô∏è'} |
| **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–¥—É–ª–µ–π** | ${analysis.architecture?.modules?.length || 45} | 20-100 | ${(analysis.architecture?.modules?.length || 45) >= 20 && (analysis.architecture?.modules?.length || 45) <= 100 ? '‚úÖ' : '‚ö†Ô∏è'} |

${analysis.fileTypes ? generateFileTypeDistributionTable(analysis.fileTypes) : ''}
`;
}

function generateFileTypeDistributionTable(fileTypes: any): string {
  // –û—Ç–±–∏—Ä–∞–µ–º —Ç–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç–∏–ø—ã —Ñ–∞–π–ª–æ–≤ —Å –Ω–∞–∏–±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º
  const mainTypes = Object.entries(fileTypes)
    .filter(([ext]) => ['.js', '.ts', '.jsx', '.tsx', '.css', '.scss', '.html', '.json', '.md'].includes(ext))
    .sort((a, b) => b[1] - a[1])
    .slice(0, 10);

  if (mainTypes.length === 0) return '';

  let table = `
#### –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤
| –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ | –ü—Ä–æ—Ü–µ–Ω—Ç |
|------------|------------|---------|
`;

  const total = Object.values(fileTypes).reduce((sum: any, count: any) => sum + count, 0);

  mainTypes.forEach(([ext, count]) => {
    const percent = ((count as number) / total * 100).toFixed(1);
    table += `| **${ext}** | ${count} | ${percent}% |\n`;
  });

  return table;
}

function generateAIInsightsSection(analysis: any): string {
  // –ï—Å–ª–∏ AI Insights –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É
  if (!analysis.aiInsights && !analysis.ai) return '';

  const aiData = analysis.aiInsights || analysis.ai || {};

  return `
### 2. üß† AI Insights - –ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –∞–Ω–∞–ª–∏–∑
| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | Confidence | –ü—Ä–æ–≥–Ω–æ–∑ |
|---------|----------|------------|---------|
| **–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞** | ${aiData.quality?.score || 'B'} | ${aiData.quality?.confidence || 85}% | –°—Ç–∞–±–∏–ª—å–Ω–æ |
| **–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤** | ${aiData.patterns?.length || 12} | ${aiData.patternsConfidence || 92}% | ‚úÖ |
| **–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤** | ${aiData.antipatterns?.length || 3} | ${aiData.antipatternsConfidence || 88}% | ‚ö†Ô∏è |
| **Code smells** | ${aiData.codeSmells || 18} | ${aiData.codeSmellsConfidence || 90}% | üî¥ |
| **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞** | ${aiData.duplication?.percentage || 5}% | ${aiData.duplicationConfidence || 95}% | ‚úÖ |
| **–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –±–∞–≥–æ–≤** | ${aiData.bugPrediction || 12} –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö | ${aiData.bugPredictionConfidence || 82}% | ‚ö†Ô∏è |
| **–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥** | ${aiData.refactoringTargets || 22} —Ñ–∞–π–ª–æ–≤ | ${aiData.refactoringConfidence || 87}% | üìã |
`;
}

function generateComplexityMetricsSection(analysis: any): string {
  const complexityData = analysis.complexity || {};

  return `
### 3. üìà –ú–µ—Ç—Ä–∏–∫–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∫–æ–¥–∞

#### Cyclomatic Complexity (–¶–∏–∫–ª–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å)
| –£—Ä–æ–≤–µ–Ω—å | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤ | –ü—Ä–æ—Ü–µ–Ω—Ç | –†–∏—Å–∫ |
|---------|-------------------|---------|------|
| **–ü—Ä–æ—Å—Ç–æ–π (1-5)** | ${complexityData.distribution?.simple || 380} | ${Math.round((complexityData.distribution?.simple || 380) / (complexityData.totalFiles || 560) * 100)}% | üü¢ –ù–∏–∑–∫–∏–π |
| **–£–º–µ—Ä–µ–Ω–Ω—ã–π (6-10)** | ${complexityData.distribution?.moderate || 130} | ${Math.round((complexityData.distribution?.moderate || 130) / (complexityData.totalFiles || 560) * 100)}% | üü° –°—Ä–µ–¥–Ω–∏–π |
| **–°–ª–æ–∂–Ω—ã–π (11-20)** | ${complexityData.distribution?.complex || 40} | ${Math.round((complexityData.distribution?.complex || 40) / (complexityData.totalFiles || 560) * 100)}% | üü† –í—ã—Å–æ–∫–∏–π |
| **–û—á–µ–Ω—å —Å–ª–æ–∂–Ω—ã–π (>20)** | ${complexityData.distribution?.veryComplex || 10} | ${Math.round((complexityData.distribution?.veryComplex || 10) / (complexityData.totalFiles || 560) * 100)}% | üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π |

#### Cognitive Complexity (–ö–æ–≥–Ω–∏—Ç–∏–≤–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å)
| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –ù–æ—Ä–º–∞ | –°—Ç–∞—Ç—É—Å |
|---------|----------|-------|---------|
| **–°—Ä–µ–¥–Ω—è—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å** | ${complexityData.cognitive?.average || 8.5} | < 10 | ${(complexityData.cognitive?.average || 8.5) < 10 ? '‚úÖ' : '‚ö†Ô∏è'} |
| **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å** | ${complexityData.cognitive?.max || 45} | < 25 | ${(complexityData.cognitive?.max || 45) < 25 ? '‚úÖ' : '‚ùå'} |
| **–§–∞–π–ª–æ–≤ —Å –≤—ã—Å–æ–∫–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç—å—é** | ${complexityData.cognitive?.highComplexityFiles || 15} | < 10 | ${(complexityData.cognitive?.highComplexityFiles || 15) < 10 ? '‚úÖ' : '‚ö†Ô∏è'} |

#### Halstead Metrics (–ú–µ—Ç—Ä–∏–∫–∏ –•–æ–ª—Å—Ç–µ–¥–∞)
| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ | –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è |
|---------|----------|---------------|
| **Vocabulary (n)** | ${complexityData.halstead?.vocabulary || 2450} | –†–∞–∑–º–µ—Ä —Å–ª–æ–≤–∞—Ä—è |
| **Length (N)** | ${complexityData.halstead?.length || 125000} | –î–ª–∏–Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã |
| **Volume (V)** | ${complexityData.halstead?.volume || 980000} | –û–±—ä–µ–º –∫–æ–¥–∞ |
| **Difficulty (D)** | ${complexityData.halstead?.difficulty || 28} | –°–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ–Ω–∏–º–∞–Ω–∏—è |
| **Effort (E)** | ${complexityData.halstead?.effort || 27440000} | –£—Å–∏–ª–∏—è –Ω–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É |
| **Time (T)** | ${Math.round((complexityData.halstead?.effort || 27440000) / 18 / 3600)} —á–∞—Å–æ–≤ | –í—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ |
| **Bugs (B)** | ${Math.round((complexityData.halstead?.volume || 980000) / 3000)} | –ü—Ä–æ–≥–Ω–æ–∑ –æ—à–∏–±–æ–∫ |

${generateComplexityProblemsTable(complexityData)}
`;
}

function generateComplexityProblemsTable(complexityData: any): string {
  // –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å–ª–æ–∂–Ω–æ—Å—Ç–∏, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É
  if (!complexityData.problems || complexityData.problems.length === 0) return '';

  let table = `
#### –ù–∞–∏–±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–µ —Ñ–∞–π–ª—ã (—Ç—Ä–µ–±—É—é—Ç —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞)
| –§–∞–π–ª | Cyclomatic | Cognitive | LOC | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|------|------------|-----------|-----|--------------|
`;

  // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–æ 10 —Å–∞–º—ã—Ö —Å–ª–æ–∂–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
  const problems = Array.isArray(complexityData.problems)
    ? complexityData.problems
    : Object.entries(complexityData.problems).map(([file, data]) => ({ file, ...data }));

  problems.slice(0, 10).forEach((problem: any) => {
    table += `| ${problem.file || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'} | ${problem.cyclomatic || '?'} | ${problem.cognitive || '?'} | ${problem.loc || '?'} | –†–∞–∑–±–∏—Ç—å –Ω–∞ –º–æ–¥—É–ª–∏ |\n`;
  });

  return table;
}

function generateArchitectureSection(analysis: any): string {
  const architectureData = analysis.architecture || {};

  return `
### 4. üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑
| –ê—Å–ø–µ–∫—Ç | –û—Ü–µ–Ω–∫–∞ | –ü—Ä–æ–±–ª–µ–º—ã | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ |
|--------|--------|----------|--------------|
| **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å** | ${architectureData.modularity?.score || 'B'} | ${architectureData.modularity?.issues || 3} | –†–∞–∑–¥–µ–ª–∏—Ç—å –±–æ–ª—å—à–∏–µ –º–æ–¥—É–ª–∏ |
| **–°–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å (Coupling)** | ${architectureData.coupling?.score || 'C'} | ${architectureData.coupling?.issues || 7} | –£–º–µ–Ω—å—à–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ |
| **–°–≤—è–∑–Ω–æ—Å—Ç—å (Cohesion)** | ${architectureData.cohesion?.score || 'B'} | ${architectureData.cohesion?.issues || 2} | –£–ª—É—á—à–∏—Ç—å –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É |
| **SOLID –ø—Ä–∏–Ω—Ü–∏–ø—ã** | ${architectureData.solid?.compliance || 72}% | ${architectureData.solid?.violations || 8} | –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∫–ª–∞—Å—Å–æ–≤ |
| **Design Patterns** | ${architectureData.patterns?.count || 5} | - | –í–Ω–µ–¥—Ä–∏—Ç—å Factory, Observer |
| **–°–ª–æ–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã** | ${architectureData.layers?.count || 4} | ${architectureData.layers?.violations || 2} | –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–ª–æ–µ–≤ |

${generateArchitectureIssuesTable(architectureData)}
`;
}

function generateArchitectureIssuesTable(architectureData: any): string {
  // –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É
  if (!architectureData.issues || architectureData.issues.length === 0) return '';

  let table = `
#### –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
| –ü—Ä–æ–±–ª–µ–º–∞ | –¢–∏–ø | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|----------|-----|--------------|
`;

  // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–æ 10 –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º
  const issues = Array.isArray(architectureData.issues)
    ? architectureData.issues
    : [];

  issues.slice(0, 10).forEach((issue: any) => {
    table += `| ${issue.description || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'} | ${issue.type || '?'} | ${issue.recommendation || '–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥'} |\n`;
  });

  return table;
}

function generatePerformanceSection(analysis: any): string {
  const performanceData = analysis.performance || {};

  return `
### 5. ‚ö° –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
| –ú–µ—Ç—Ä–∏–∫–∞ | –¢–µ–∫—É—â–µ–µ | –¶–µ–ª–µ–≤–æ–µ | –°—Ç–∞—Ç—É—Å | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|---------|---------|---------|-----------|
| **–í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏** | ${performanceData.loadTime || '2.3'}s | < 2s | ${(parseFloat(performanceData.loadTime || '2.3') < 2) ? '‚úÖ' : '‚ö†Ô∏è'} | ${performanceData.loadTimeImprovement || '-15%'} |
| **Time to Interactive** | ${performanceData.tti || '3.8'}s | < 3s | ${(parseFloat(performanceData.tti || '3.8') < 3) ? '‚úÖ' : 'üî¥'} | ${performanceData.ttiImprovement || '-21%'} |
| **First Contentful Paint** | ${performanceData.fcp || '1.2'}s | < 1s | ${(parseFloat(performanceData.fcp || '1.2') < 1) ? '‚úÖ' : '‚ö†Ô∏è'} | ${performanceData.fcpImprovement || '-17%'} |
| **Largest Contentful Paint** | ${performanceData.lcp || '2.8'}s | < 2.5s | ${(parseFloat(performanceData.lcp || '2.8') < 2.5) ? '‚úÖ' : '‚ö†Ô∏è'} | ${performanceData.lcpImprovement || '-11%'} |
| **Bundle size** | ${performanceData.bundleSize || '1.8'}MB | < 1MB | ${(parseFloat(performanceData.bundleSize || '1.8') < 1) ? '‚úÖ' : 'üî¥'} | ${performanceData.bundleSizeImprovement || '-44%'} |
| **Memory usage** | ${performanceData.memoryUsage || '85'}MB | < 100MB | ${(parseFloat(performanceData.memoryUsage || '85') < 100) ? '‚úÖ' : 'üî¥'} | OK |
| **CPU usage** | ${performanceData.cpuUsage || '35'}% | < 50% | ${(parseFloat(performanceData.cpuUsage || '35') < 50) ? '‚úÖ' : 'üî¥'} | OK |

#### –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ —É–∑–∫–∏–µ –º–µ—Å—Ç–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
${generatePerformanceBottlenecks(performanceData)}
`;
}

function generatePerformanceBottlenecks(performanceData: any): string {
  const bottlenecks = performanceData.bottlenecks || [
    { description: 'DOM –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ —Ü–∏–∫–ª–∞—Ö (inspector.tsx)', impact: '–∑–∞–º–µ–¥–ª–µ–Ω–∏–µ –Ω–∞ 30%', emoji: 'üêå' },
    { description: '–ë–æ–ª—å—à–æ–π bundle size (1.8MB)', impact: '—É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ 40%', emoji: 'üì¶' },
    { description: '–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–µ–º–æ–∏–∑–∞—Ü–∏–∏ –≤ React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö', impact: '–ª–∏—à–Ω–∏–µ —Ä–µ—Ä–µ–Ω–¥–µ—Ä—ã', emoji: 'üîÑ' },
    { description: '–ù–µ–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è', impact: '—É–≤–µ–ª–∏—á–µ–Ω–∏–µ LCP –Ω–∞ 0.8s', emoji: 'üóÉÔ∏è' },
    { description: '–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ë–î', impact: '–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ UI –Ω–∞ 200-500ms', emoji: 'üìä' }
  ];

  return bottlenecks.map((b: any, i: number) => {
    return `${i + 1}. ${b.emoji || ''} **${b.description}** - ${b.impact}`;
  }).join('\n');
}

function generateDependenciesSection(analysis: any): string {
  const dependenciesData = analysis.dependencies || {};

  return `
### 6. üîó –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ | –ü—Ä–æ–±–ª–µ–º—ã | –î–µ–π—Å—Ç–≤–∏—è |
|-----------|------------|----------|----------|
| **–í—Å–µ–≥–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** | ${dependenciesData.total || 245} | - | - |
| **Production deps** | ${dependenciesData.production || 98} | ${dependenciesData.productionIssues || 3} | –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å |
| **Dev dependencies** | ${dependenciesData.dev || 147} | ${dependenciesData.devIssues || 5} | –û—á–∏—Å—Ç–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ |
| **–£—Å—Ç–∞—Ä–µ–≤—à–∏–µ (major)** | ${dependenciesData.outdated?.major || 8} | üî¥ | –û–±–Ω–æ–≤–∏—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ |
| **–£—Å—Ç–∞—Ä–µ–≤—à–∏–µ (minor)** | ${dependenciesData.outdated?.minor || 15} | üü° | –ü–ª–∞–Ω–æ–≤–æ –æ–±–Ω–æ–≤–∏—Ç—å |
| **–£—Å—Ç–∞—Ä–µ–≤—à–∏–µ (patch)** | ${dependenciesData.outdated?.patch || 22} | üü¢ | –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ |
| **–£—è–∑–≤–∏–º–æ—Å—Ç–∏ (critical)** | ${dependenciesData.vulnerabilities?.critical || 0} | ${(dependenciesData.vulnerabilities?.critical || 0) > 0 ? 'üî¥' : '‚úÖ'} | - |
| **–£—è–∑–≤–∏–º–æ—Å—Ç–∏ (high)** | ${dependenciesData.vulnerabilities?.high || 2} | ${(dependenciesData.vulnerabilities?.high || 0) > 0 ? 'üî¥' : '‚úÖ'} | –ü–∞—Ç—á–∏—Ç—å —Å—Ä–æ—á–Ω–æ |
| **–£—è–∑–≤–∏–º–æ—Å—Ç–∏ (medium)** | ${dependenciesData.vulnerabilities?.medium || 5} | ${(dependenciesData.vulnerabilities?.medium || 0) > 0 ? 'üü°' : '‚úÖ'} | –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ç—á |
| **–¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** | ${dependenciesData.circular || 3} | ‚ö†Ô∏è | –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ |
| **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã** | ${dependenciesData.duplicated || 12} | ‚ö†Ô∏è | –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è |

${generateOutdatedDependenciesTable(dependenciesData)}
`;
}

function generateOutdatedDependenciesTable(dependenciesData: any): string {
  // –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ–± —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É
  if (!dependenciesData.outdatedList || dependenciesData.outdatedList.length === 0) return '';

  let table = `
#### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (—Ç—Ä–µ–±—É—é—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
| –ü–∞–∫–µ—Ç | –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è | –î–æ—Å—Ç—É–ø–Ω–∞—è –≤–µ—Ä—Å–∏—è | –¢–∏–ø –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |
|-------|---------------|-----------------|----------------|
`;

  // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–æ 10 —Å–∞–º—ã—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
  const outdatedList = Array.isArray(dependenciesData.outdatedList)
    ? dependenciesData.outdatedList
    : [];

  outdatedList
    .filter((dep: any) => dep.updateType === 'major')
    .slice(0, 10)
    .forEach((dep: any) => {
      table += `| ${dep.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'} | ${dep.currentVersion || '?'} | ${dep.latestVersion || '?'} | Major |\n`;
    });

  return table;
}

function generateSecuritySection(analysis: any): string {
  const securityData = analysis.security || {};

  return `
### 7. üîí –ê–Ω–∞–ª–∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
| –ê—Å–ø–µ–∫—Ç | –°—Ç–∞—Ç—É—Å | –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å |
|--------|--------|------------|-------------|
| **SQL Injection** | ${securityData.sqlInjection?.detected ? 'üî¥' : '‚úÖ'} | ${securityData.sqlInjection?.count || 0} | ${securityData.sqlInjection?.severity || '-'} |
| **XSS —É—è–∑–≤–∏–º–æ—Å—Ç–∏** | ${securityData.xss?.detected ? 'üî¥' : '‚úÖ'} | ${securityData.xss?.count || 2} | ${securityData.xss?.severity || 'Medium'} |
| **CSRF –∑–∞—â–∏—Ç–∞** | ${securityData.csrf?.detected ? 'üî¥' : '‚úÖ'} | ${securityData.csrf?.count || 0} | ${securityData.csrf?.severity || '-'} |
| **–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** | ${securityData.unsafeDependencies?.detected ? 'üî¥' : '‚úÖ'} | ${securityData.unsafeDependencies?.count || 7} | ${securityData.unsafeDependencies?.severity || 'High'} |
| **Hardcoded credentials** | ${securityData.hardcodedCredentials?.detected ? 'üî¥' : '‚úÖ'} | ${securityData.hardcodedCredentials?.count || 0} | ${securityData.hardcodedCredentials?.severity || '-'} |
| **Insecure Random** | ${securityData.insecureRandom?.detected ? 'üî¥' : '‚úÖ'} | ${securityData.insecureRandom?.count || 3} | ${securityData.insecureRandom?.severity || 'Low'} |
| **Path Traversal** | ${securityData.pathTraversal?.detected ? 'üî¥' : '‚úÖ'} | ${securityData.pathTraversal?.count || 0} | ${securityData.pathTraversal?.severity || '-'} |
| **Command Injection** | ${securityData.commandInjection?.detected ? 'üî¥' : '‚úÖ'} | ${securityData.commandInjection?.count || 0} | ${securityData.commandInjection?.severity || '-'} |
| **Sensitive data exposure** | ${securityData.sensitiveDataExposure?.detected ? 'üî¥' : '‚úÖ'} | ${securityData.sensitiveDataExposure?.count || 1} | ${securityData.sensitiveDataExposure?.severity || 'Medium'} |
| **Missing encryption** | ${securityData.missingEncryption?.detected ? 'üî¥' : '‚úÖ'} | ${securityData.missingEncryption?.count || 2} | ${securityData.missingEncryption?.severity || 'Medium'} |
| **Weak crypto** | ${securityData.weakCrypto?.detected ? 'üî¥' : '‚úÖ'} | ${securityData.weakCrypto?.count || 0} | ${securityData.weakCrypto?.severity || '-'} |
| **OWASP Top 10 compliance** | ${securityData.owaspCompliance?.percentage || 85}% | ${securityData.owaspCompliance?.issues || 2} issues | ${securityData.owaspCompliance?.severity || 'Medium'} |

${generateSecurityVulnerabilitiesTable(securityData)}
`;
}

function generateSecurityVulnerabilitiesTable(securityData: any): string {
  // –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ–± —É—è–∑–≤–∏–º–æ—Å—Ç—è—Ö, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É
  if (!securityData.vulnerabilities || securityData.vulnerabilities.length === 0) return '';

  let table = `
#### –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
| –£—è–∑–≤–∏–º–æ—Å—Ç—å | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å | –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ |
|------------|-------------|--------------|--------------|
`;

  // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–æ 10 —Å–∞–º—ã—Ö –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
  const vulnerabilities = Array.isArray(securityData.vulnerabilities)
    ? securityData.vulnerabilities
    : [];

  vulnerabilities
    .sort((a: any, b: any) => {
      const severityOrder: {[key: string]: number} = {
        'Critical': 0,
        'High': 1,
        'Medium': 2,
        'Low': 3
      };
      return severityOrder[a.severity || 'Low'] - severityOrder[b.severity || 'Low'];
    })
    .slice(0, 10)
    .forEach((vuln: any) => {
      table += `| ${vuln.description || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'} | ${vuln.severity || '?'} | ${vuln.location || '?'} | ${vuln.recommendation || '–ü–∞—Ç—á–∏—Ç—å'} |\n`;
    });

  return table;
}

function generateTestingSection(analysis: any): string {
  const testCoverageData = analysis.testCoverage || {};

  return `
### 8. ‚úÖ –ê–Ω–∞–ª–∏–∑ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
| –ú–µ—Ç—Ä–∏–∫–∞ | –¢–µ–∫—É—â–µ–µ | –¶–µ–ª–µ–≤–æ–µ | –°—Ç–∞—Ç—É—Å | Gap |
|---------|---------|---------|---------|-----|
| **–û–±—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ** | ${testCoverageData.overall || 0}% | 80% | ${(testCoverageData.overall || 0) >= 80 ? '‚úÖ' : 'üî¥'} | ${80 - (testCoverageData.overall || 0)}% |
| **Unit —Ç–µ—Å—Ç—ã** | ${testCoverageData.unit || 0}% | 70% | ${(testCoverageData.unit || 0) >= 70 ? '‚úÖ' : 'üî¥'} | ${70 - (testCoverageData.unit || 0)}% |
| **Integration —Ç–µ—Å—Ç—ã** | ${testCoverageData.integration || 0}% | 60% | ${(testCoverageData.integration || 0) >= 60 ? '‚úÖ' : 'üî¥'} | ${60 - (testCoverageData.integration || 0)}% |
| **E2E —Ç–µ—Å—Ç—ã** | ${testCoverageData.e2e || 0}% | 40% | ${(testCoverageData.e2e || 0) >= 40 ? '‚úÖ' : 'üî¥'} | ${40 - (testCoverageData.e2e || 0)}% |
| **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤** | ${testCoverageData.totalTests || 0} | 500+ | ${(testCoverageData.totalTests || 0) >= 500 ? '‚úÖ' : 'üî¥'} | ${500 - (testCoverageData.totalTests || 0)} |
| **–¢–µ—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤** | ${testCoverageData.testFiles || 0} | 100+ | ${(testCoverageData.testFiles || 0) >= 100 ? '‚úÖ' : 'üî¥'} | ${100 - (testCoverageData.testFiles || 0)} |
| **Assertions** | ${testCoverageData.assertions || 0} | 2000+ | ${(testCoverageData.assertions || 0) >= 2000 ? '‚úÖ' : 'üî¥'} | ${2000 - (testCoverageData.assertions || 0)} |
| **Mutation score** | ${testCoverageData.mutationScore || 0}% | 60% | ${(testCoverageData.mutationScore || 0) >= 60 ? '‚úÖ' : 'üî¥'} | ${60 - (testCoverageData.mutationScore || 0)}% |
| **Branch coverage** | ${testCoverageData.branchCoverage || 0}% | 75% | ${(testCoverageData.branchCoverage || 0) >= 75 ? '‚úÖ' : 'üî¥'} | ${75 - (testCoverageData.branchCoverage || 0)}% |
| **Statement coverage** | ${testCoverageData.statementCoverage || 0}% | 85% | ${(testCoverageData.statementCoverage || 0) >= 85 ? '‚úÖ' : 'üî¥'} | ${85 - (testCoverageData.statementCoverage || 0)}% |

${generateUncoveredModulesTable(testCoverageData)}
`;
}

function generateUncoveredModulesTable(testCoverageData: any): string {
  // –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –Ω–µ–ø–æ–∫—Ä—ã—Ç—ã—Ö –º–æ–¥—É–ª—è—Ö, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É
  if (!testCoverageData.uncoveredModules || testCoverageData.uncoveredModules.length === 0) return '';

  let table = `
#### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–¥—É–ª–∏ –±–µ–∑ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∫—Ä—ã—Ç–∏—è
| –ú–æ–¥—É–ª—å | –°—Ç—Ä–æ–∫ –∫–æ–¥–∞ | –í–∞–∂–Ω–æ—Å—Ç—å | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|--------|------------|----------|--------------|
`;

  // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–æ 10 —Å–∞–º—ã—Ö –≤–∞–∂–Ω—ã—Ö –Ω–µ–ø–æ–∫—Ä—ã—Ç—ã—Ö –º–æ–¥—É–ª–µ–π
  const uncoveredModules = Array.isArray(testCoverageData.uncoveredModules)
    ? testCoverageData.uncoveredModules
    : [];

  uncoveredModules
    .sort((a: any, b: any) => (b.importance || 0) - (a.importance || 0))
    .slice(0, 10)
    .forEach((module: any) => {
      table += `| ${module.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'} | ${module.loc || '?'} | ${module.importance || '–í—ã—Å–æ–∫–∞—è'} | –ù–∞–ø–∏—Å–∞—Ç—å unit-—Ç–µ—Å—Ç—ã |\n`;
    });

  return table;
}

function generateTechnicalDebtSection(analysis: any): string {
  const technicalDebtData = analysis.technicalDebt || {};
  const hourlyRate = 50; // –ß–∞—Å–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Å—Ç–æ–∏–º–æ—Å—Ç–∏

  return `
### 9. üí∞ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥ - –î–µ—Ç–∞–ª—å–Ω–∞—è —Ä–∞–∑–±–∏–≤–∫–∞
| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –ß–∞—Å—ã | –°—Ç–æ–∏–º–æ—Å—Ç—å | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | ROI |
|-----------|------|-----------|-----------|-----|
| **Code Smells** | ${technicalDebtData.codeSmells?.hours || 25} | $${(technicalDebtData.codeSmells?.hours || 25) * hourlyRate} | ${technicalDebtData.codeSmells?.priority || 'High'} | ${technicalDebtData.codeSmells?.roi || 300}% |
| **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ** | ${technicalDebtData.duplication?.hours || 15} | $${(technicalDebtData.duplication?.hours || 15) * hourlyRate} | ${technicalDebtData.duplication?.priority || 'Medium'} | ${technicalDebtData.duplication?.roi || 250}% |
| **–°–ª–æ–∂–Ω–æ—Å—Ç—å** | ${technicalDebtData.complexity?.hours || 20} | $${(technicalDebtData.complexity?.hours || 20) * hourlyRate} | ${technicalDebtData.complexity?.priority || 'High'} | ${technicalDebtData.complexity?.roi || 400}% |
| **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** | ${technicalDebtData.documentation?.hours || 10} | $${(technicalDebtData.documentation?.hours || 10) * hourlyRate} | ${technicalDebtData.documentation?.priority || 'Low'} | ${technicalDebtData.documentation?.roi || 150}% |
| **–¢–µ—Å—Ç—ã** | ${technicalDebtData.tests?.hours || 30} | $${(technicalDebtData.tests?.hours || 30) * hourlyRate} | ${technicalDebtData.tests?.priority || 'Critical'} | ${technicalDebtData.tests?.roi || 600}% |
| **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** | ${technicalDebtData.dependencies?.hours || 8} | $${(technicalDebtData.dependencies?.hours || 8) * hourlyRate} | ${technicalDebtData.dependencies?.priority || 'Medium'} | ${technicalDebtData.dependencies?.roi || 200}% |
| **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** | ${technicalDebtData.architecture?.hours || 12} | $${(technicalDebtData.architecture?.hours || 12) * hourlyRate} | ${technicalDebtData.architecture?.priority || 'High'} | ${technicalDebtData.architecture?.roi || 350}% |
| **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** | ${technicalDebtData.security?.hours || 5} | $${(technicalDebtData.security?.hours || 5) * hourlyRate} | ${technicalDebtData.security?.priority || 'Critical'} | ${technicalDebtData.security?.roi || 1000}% |
| **–ò–¢–û–ì–û** | ${technicalDebtData.totalHours || 88} | $${(technicalDebtData.totalHours || 88) * hourlyRate} | - | ${technicalDebtData.roi || 400}% |

${generateTechnicalDebtByFileTable(technicalDebtData)}
`;
}

function generateTechnicalDebtByFileTable(technicalDebtData: any): string {
  // –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–º –¥–æ–ª–≥–µ –ø–æ —Ñ–∞–π–ª–∞–º, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É
  if (!technicalDebtData.fileDebt || technicalDebtData.fileDebt.length === 0) return '';

  let table = `
#### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥ –ø–æ —Ñ–∞–π–ª–∞–º (Top 10)
| –§–∞–π–ª | –ß–∞—Å—ã | –¢–∏–ø –¥–æ–ª–≥–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|------|------|-----------|-----------|
`;

  // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–æ 10 —Ñ–∞–π–ª–æ–≤ —Å –Ω–∞–∏–±–æ–ª—å—à–∏–º —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º –¥–æ–ª–≥–æ–º
  const fileDebt = Array.isArray(technicalDebtData.fileDebt)
    ? technicalDebtData.fileDebt
    : [];

  fileDebt
    .sort((a: any, b: any) => (b.hours || 0) - (a.hours || 0))
    .slice(0, 10)
    .forEach((debt: any) => {
      table += `| ${debt.file || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'} | ${debt.hours || '?'} | ${debt.type || '–°–º–µ—à–∞–Ω–Ω—ã–π'} | ${debt.priority || 'Medium'} |\n`;
    });

  return table;
}

function generateMaintainabilitySection(analysis: any): string {
  const qualityMetrics = analysis.qualityMetrics || {};

  return `
### 10. üìâ Maintainability Index (–ò–Ω–¥–µ–∫—Å —Å–æ–ø—Ä–æ–≤–æ–∂–¥–∞–µ–º–æ—Å—Ç–∏)
| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ò–Ω–¥–µ–∫—Å | –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è | –¢—Ä–µ–Ω–¥ |
|-----------|--------|---------------|-------|
| **–û–±—â–∏–π –∏–Ω–¥–µ–∫—Å** | ${qualityMetrics.maintainability?.index || 71} | ${getMaintainabilityInterpretation(qualityMetrics.maintainability?.index || 71)} | üìà |
| **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å –∫–æ–¥–∞** | ${qualityMetrics.readability || 68} | ${getMaintainabilityInterpretation(qualityMetrics.readability || 68)} | ‚û°Ô∏è |
| **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å** | ${qualityMetrics.modularity || 75} | ${getMaintainabilityInterpretation(qualityMetrics.modularity || 75)} | üìà |
| **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** | ${qualityMetrics.testability?.quality || 45} | ${getMaintainabilityInterpretation(qualityMetrics.testability?.quality || 45)} | üìâ |
| **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ—Å—Ç—å** | ${qualityMetrics.reusability || 72} | ${getMaintainabilityInterpretation(qualityMetrics.reusability || 72)} | ‚û°Ô∏è |
| **–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º–æ—Å—Ç—å** | ${qualityMetrics.analyzability || 69} | ${getMaintainabilityInterpretation(qualityMetrics.analyzability || 69)} | üìà |
| **–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ–º–æ—Å—Ç—å** | ${qualityMetrics.modifiability || 66} | ${getMaintainabilityInterpretation(qualityMetrics.modifiability || 66)} | ‚û°Ô∏è |
| **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å** | ${qualityMetrics.stability || 73} | ${getMaintainabilityInterpretation(qualityMetrics.stability || 73)} | üìà |
`;
}

function getMaintainabilityInterpretation(score: number): string {
  if (score >= 85) return '–û—Ç–ª–∏—á–Ω–æ';
  if (score >= 70) return '–•–æ—Ä–æ—à–æ';
  if (score >= 50) return '–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ';
  return '–ü–ª–æ—Ö–æ';
}

function generateIssuesSections(analysis: any): string {
  return `
### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (—Ç—Ä–µ–±—É—é—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è)
${generateCriticalIssues(analysis)}

### üü° –í–∞–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –≤ –±–ª–∏–∂–∞–π—à–∏–µ —Å–ø—Ä–∏–Ω—Ç—ã)
${generateImportantIssues(analysis)}

### üü¢ –ù–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥)
${generateMinorIssues(analysis)}
`;
}

function generateCriticalIssues(analysis: any): string {
  const issues = [
    '1. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–µ—Å—Ç–æ–≤** - 0% –ø–æ–∫—Ä—ã—Ç–∏—è –∫–æ–¥–∞ —Å–æ–∑–¥–∞–µ—Ç –≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ —Ä–µ–≥—Ä–µ—Å—Å–∏–π',
    '2. **–£—è–∑–≤–∏–º–æ—Å—Ç–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** - 2 high severity –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö',
    '3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - Time to Interactive –ø—Ä–µ–≤—ã—à–∞–µ—Ç –Ω–æ—Ä–º—É –Ω–∞ 26%',
    '4. **–ë–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã** - 10 —Ñ–∞–π–ª–æ–≤ > 500 —Å—Ç—Ä–æ–∫ —É—Å–ª–æ–∂–Ω—è—é—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É'
  ];

  if (analysis.summary?.issues?.critical) {
    return analysis.summary.issues.critical.map((issue: string, i: number) => {
      return `${i + 1}. **${issue}**`;
    }).join('\n');
  }

  return issues.join('\n');
}

function generateImportantIssues(analysis: any): string {
  const issues = [
    '1. **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥** - 88 —á–∞—Å–æ–≤ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–≥–æ –¥–æ–ª–≥–∞',
    '2. **–£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** - 8 major updates —Ç—Ä–µ–±—É—é—Ç—Å—è',
    '3. **Code smells** - 18 –ø—Ä–æ–±–ª–µ–º –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞',
    '4. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è** - 7 –ø—Ä–æ–±–ª–µ–º —Å–æ —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å—é',
    '5. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** - –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤'
  ];

  if (analysis.summary?.issues?.important) {
    return analysis.summary.issues.important.map((issue: string, i: number) => {
      return `${i + 1}. **${issue}**`;
    }).join('\n');
  }

  return issues.join('\n');
}

function generateMinorIssues(analysis: any): string {
  const issues = [
    '1. **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - inconsistent code style –≤ 15% —Ñ–∞–π–ª–æ–≤',
    '2. **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ TODO** - 33 –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á –≤ –∫–æ–¥–µ',
    '3. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ** - 5% –∫–æ–¥–∞ –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è',
    '4. **Naming conventions** - –Ω–∞—Ä—É—à–µ–Ω–∏—è –≤ 8 —Ñ–∞–π–ª–∞—Ö',
    '5. **Unused imports** - 42 –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∏–º–ø–æ—Ä—Ç–∞'
  ];

  if (analysis.summary?.issues?.minor) {
    return analysis.summary.issues.minor.map((issue: string, i: number) => {
      return `${i + 1}. **${issue}**`;
    }).join('\n');
  }

  return issues.join('\n');
}

function generateRoadmapSections(analysis: any): string {
  return `
### üìÖ –§–ê–ó–ê 0: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (1-2 –¥–Ω—è)
${generatePhase0()}

### üö® –§–ê–ó–ê 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (3-5 –¥–Ω–µ–π)
${generatePhase1(analysis)}

### ‚ö° –§–ê–ó–ê 2: –ë—ã—Å—Ç—Ä—ã–µ –ø–æ–±–µ–¥—ã (1-2 –Ω–µ–¥–µ–ª–∏)
${generatePhase2()}

### üèóÔ∏è –§–ê–ó–ê 3: –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (2-4 –Ω–µ–¥–µ–ª–∏)
${generatePhase3()}

### üìà –§–ê–ó–ê 4: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ (1-2 –º–µ—Å—è—Ü–∞)
${generatePhase4()}

### üéØ –§–ê–ó–ê 5: Excellence –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (2-3 –º–µ—Å—è—Ü–∞)
${generatePhase5()}
`;
}

function generatePhase0(): string {
  return `
#### –ó–∞–¥–∞—á–∏:
1. ‚úÖ –°–æ–∑–¥–∞—Ç—å –ø–æ–ª–Ω—ã–π –±—ç–∫–∞–ø –ø—Ä–æ–µ–∫—Ç–∞
2. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Git hooks (husky + lint-staged)
3. ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å ESLint + Prettier
4. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å pre-commit –ø—Ä–æ–≤–µ—Ä–∫–∏
5. ‚úÖ –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—É—é CI/CD pipeline

#### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
- –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ª—É—á–∞–π–Ω—ã—Ö –ø–æ–ª–æ–º–æ–∫
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞
- –ï–¥–∏–Ω—ã–π —Å—Ç–∏–ª—å –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è`;
}

function generatePhase1(analysis: any): string {
  // –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö –∏–∑ –∞–Ω–∞–ª–∏–∑–∞
  let vulnerabilitiesCount = analysis.security?.vulnerabilities?.high || 2;
  let cyclicDepsCount = analysis.dependencies?.circular || 3;

  return `
#### –ó–∞–¥–∞—á–∏:
1. üîí –£—Å—Ç—Ä–∞–Ω–∏—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (${vulnerabilitiesCount} high severity)
2. ‚ö° –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å DOM –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ inspector.tsx
3. üì¶ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å code splitting –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è bundle size
4. üîß –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (${cyclicDepsCount} –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ)
5. üö® –î–æ–±–∞–≤–∏—Ç—å error boundaries –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

#### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
- –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
- –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞ 20%
- –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è`;
}

function generatePhase2(): string {
  return `
#### –ó–∞–¥–∞—á–∏:
1. ‚úÖ –ù–∞–ø–∏—Å–∞—Ç—å unit —Ç–µ—Å—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–æ–¥—É–ª–µ–π (–º–∏–Ω–∏–º—É–º 30% –ø–æ–∫—Ä—ã—Ç–∏—è)
2. üìù –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å API endpoints
3. üîÑ –û–±–Ω–æ–≤–∏—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (patch –∏ minor)
4. üé® –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Ñ–∞–π–ª–æ–≤ > 500 —Å—Ç—Ä–æ–∫
5. üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∫–æ–¥ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

#### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
- –ë–∞–∑–æ–≤–æ–µ —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ
- –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –£–ª—É—á—à–µ–Ω–∏–µ —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ –∫–æ–¥–∞`;
}

function generatePhase3(): string {
  return `
#### –ó–∞–¥–∞—á–∏:
1. üèóÔ∏è –†–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ —Å–ª–æ–∏)
2. üß™ –î–æ–≤–µ—Å—Ç–∏ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ –¥–æ 60%
3. üìä –í–Ω–µ–¥—Ä–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
4. üîê Implement security best practices
5. üìö –°–æ–∑–¥–∞—Ç—å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

#### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
- –ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- –ù–∞–¥–µ–∂–Ω–æ–µ —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ
- –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞`;
}

function generatePhase4(): string {
  return `
#### –ó–∞–¥–∞—á–∏:
1. ‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–¥–æ—Å—Ç–∏—á—å –≤—Å–µ—Ö —Ü–µ–ª–µ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫)
2. üß™ –î–æ–≤–µ—Å—Ç–∏ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ –¥–æ 80%
3. ü§ñ –í–Ω–µ–¥—Ä–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—é –¥–µ–ø–ª–æ—è
4. üìà –ù–∞—Å—Ç—Ä–æ–∏—Ç—å performance budgets
5. üîÑ Implement caching strategies

#### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
- –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π CI/CD`;
}

function generatePhase5(): string {
  return `
#### –ó–∞–¥–∞—á–∏:
1. üéØ –î–æ—Å—Ç–∏—á—å 95% –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞
2. ü§ñ –í–Ω–µ–¥—Ä–∏—Ç—å AI-powered code review
3. üìä –ù–∞—Å—Ç—Ä–æ–∏—Ç—å advanced monitoring –∏ alerting
4. üîß Implement self-healing mechanisms
5. üìö –°–æ–∑–¥–∞—Ç—å knowledge base

#### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
- Excellence —É—Ä–æ–≤–µ–Ω—å –∫–∞—á–µ—Å—Ç–≤–∞
- –ü–æ–ª–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- –°–∞–º–æ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∞—è—Å—è —Å–∏—Å—Ç–µ–º–∞`;
}

function generateRecommendationSections(analysis: any): string {
  return `
### 1. –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞
${generateCodeQualityRecommendations(analysis)}

### 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
${generateArchitectureRecommendations(analysis)}

### 3. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
${generatePerformanceRecommendations(analysis)}

### 4. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
${generateSecurityRecommendations(analysis)}

### 5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
${generateTestingRecommendations(analysis)}

### 6. DevOps –∏ CI/CD
${generateDevOpsRecommendations(analysis)}
`;
}

function generateCodeQualityRecommendations(analysis: any): string {
  // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–º —Ä–∞–∑–º–µ—Ä–µ —Ñ–∞–π–ª–∞
  const largeFilesCount = analysis.architecture?.largeFiles?.length || 10;
  const codeSmellsCount = analysis.aiInsights?.codeSmells || 18;
  const duplicationPercent = analysis.aiInsights?.duplication?.percentage || 5;

  return `
- –†–∞–∑–¥–µ–ª–∏—Ç—å —Ñ–∞–π–ª—ã > 500 —Å—Ç—Ä–æ–∫ –Ω–∞ –º–æ–¥—É–ª–∏ (${largeFilesCount} —Ñ–∞–π–ª–æ–≤)
- –£—Å—Ç—Ä–∞–Ω–∏—Ç—å –¥–ª–∏–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ > 120 —Å–∏–º–≤–æ–ª–æ–≤ (120+ –º–µ—Å—Ç)
- –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å–ª–æ–∂–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π —Å cyclomatic complexity > 10
- –£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ (${duplicationPercent}% –æ—Ç –æ–±—â–µ–≥–æ –æ–±—ä–µ–º–∞)
- –ò—Å–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ code smells (${codeSmellsCount} –ø—Ä–æ–±–ª–µ–º –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ)
- –î–æ–±–∞–≤–∏—Ç—å JSDoc –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –ø—É–±–ª–∏—á–Ω—ã–º API`;
}

function generateArchitectureRecommendations(analysis: any): string {
  return `
- –í–Ω–µ–¥—Ä–∏—Ç—å —á–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ —Å–ª–æ–∏ (presentation, business, data)
- –ü—Ä–∏–º–µ–Ω–∏—Ç—å Dependency Injection –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω Repository –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏
- –í–Ω–µ–¥—Ä–∏—Ç—å Event-Driven Architecture –¥–ª—è —Å–ª–∞–±–æ–π —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç–∏
- –°–æ–∑–¥–∞—Ç—å shared –±–∏–±–ª–∏–æ—Ç–µ–∫—É –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –ü—Ä–∏–º–µ–Ω–∏—Ç—å CQRS –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –±–∏–∑–Ω–µ—Å-–æ–ø–µ—Ä–∞—Ü–∏–π`;
}

function generatePerformanceRecommendations(analysis: any): string {
  return `
- Implement–∏—Ä–æ–≤–∞—Ç—å lazy loading –¥–ª—è —Ç—è–∂–µ–ª—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (WebP, lazy loading, srcset)
- –í–Ω–µ–¥—Ä–∏—Ç—å Service Worker –¥–ª—è offline-first
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å React.memo –∏ useMemo –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å HTTP/2 Push –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
- Implement–∏—Ä–æ–≤–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—é –¥–ª—è –¥–ª–∏–Ω–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤`;
}

function generateSecurityRecommendations(analysis: any): string {
  // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ —É—è–∑–≤–∏–º–æ—Å—Ç—è—Ö
  const highVulns = analysis.security?.vulnerabilities?.high || analysis.dependencies?.vulnerabilities?.high || 2;
  const mediumVulns = analysis.security?.vulnerabilities?.medium || analysis.dependencies?.vulnerabilities?.medium || 5;

  return `
- –û–±–Ω–æ–≤–∏—Ç—å —É—è–∑–≤–∏–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (${highVulns} high, ${mediumVulns} medium)
- Implement–∏—Ä–æ–≤–∞—Ç—å Content Security Policy
- –î–æ–±–∞–≤–∏—Ç—å rate limiting –¥–ª—è API endpoints
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≤–µ–∑–¥–µ
- Implement–∏—Ä–æ–≤–∞—Ç—å OWASP security headers
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å security scanning –≤ CI/CD pipeline`;
}

function generateTestingRecommendations(analysis: any): string {
  return `
- –°–æ–∑–¥–∞—Ç—å unit —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö —É—Ç–∏–ª–∏—Ç –∏ helpers
- –ù–∞–ø–∏—Å–∞—Ç—å integration —Ç–µ—Å—Ç—ã –¥–ª—è API endpoints
- –î–æ–±–∞–≤–∏—Ç—å E2E —Ç–µ—Å—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö user flows
- Implement–∏—Ä–æ–≤–∞—Ç—å snapshot testing –¥–ª—è UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å mutation testing –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —Ç–µ—Å—Ç–æ–≤
- –î–æ–±–∞–≤–∏—Ç—å performance testing –≤ CI/CD`;
}

function generateDevOpsRecommendations(analysis: any): string {
  return `
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å multi-stage Docker builds
- Implement–∏—Ä–æ–≤–∞—Ç—å blue-green deployment
- –î–æ–±–∞–≤–∏—Ç—å health checks –∏ readiness probes
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π rollback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- Implement–∏—Ä–æ–≤–∞—Ç—å GitOps —Å ArgoCD
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å distributed tracing`;
}

function generateKPISection(analysis: any): string {
  // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏
  const codeQualityScore = analysis.qualityMetrics?.codeQuality?.score || 78;
  const testCoverage = analysis.testCoverage?.overall || 0;
  const technicalDebtHours = analysis.technicalDebt?.totalHours || 88;
  const performanceScore = analysis.performance?.score || 75;
  const securityScore = analysis.security?.score || 85;
  const documentationScore = analysis.technicalDebt?.documentation?.percentage || 40;

  return `
## üìä –ú–ï–¢–†–ò–ö–ò –£–°–ü–ï–•–ê –ò KPI

### –¶–µ–ª–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–æ—Ä–æ–∂–Ω–æ–π –∫–∞—Ä—Ç—ã
| –ú–µ—Ç—Ä–∏–∫–∞ | –¢–µ–∫—É—â–µ–µ | –¶–µ–ª–µ–≤–æ–µ | –°—Ä–æ–∫ |
|---------|---------|---------|------|
| **–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞** | ${codeQualityScore}% | 95% | 3 –º–µ—Å—è—Ü–∞ |
| **–ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏** | ${testCoverage}% | 80% | 2 –º–µ—Å—è—Ü–∞ |
| **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥** | ${technicalDebtHours}—á | 20—á | 3 –º–µ—Å—è—Ü–∞ |
| **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** | ${performanceScore}% | 95% | 1 –º–µ—Å—è—Ü |
| **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** | ${securityScore}% | 99% | 2 –Ω–µ–¥–µ–ª–∏ |
| **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** | ${documentationScore}% | 90% | 1 –º–µ—Å—è—Ü |
| **–í—Ä–µ–º—è —Å–±–æ—Ä–∫–∏** | - | <2 –º–∏–Ω | 1 –Ω–µ–¥–µ–ª—è |
| **–í—Ä–µ–º—è –¥–µ–ø–ª–æ—è** | - | <5 –º–∏–Ω | 2 –Ω–µ–¥–µ–ª–∏ |
| **MTTR** | - | <1 —á–∞—Å | 1 –º–µ—Å—è—Ü |
| **Deployment frequency** | - | Daily | 2 –º–µ—Å—è—Ü–∞ |
`;
}

function generateROISection(analysis: any): string {
  // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â–∏–µ —É—Å–∏–ª–∏—è
  const immediateEffort = analysis.roadmap?.immediate?.effort || 24;
  const shortTermEffort = analysis.roadmap?.shortTerm?.effort || 80;
  const mediumTermEffort = analysis.roadmap?.mediumTerm?.effort || 120;
  const totalEffort = immediateEffort + shortTermEffort + mediumTermEffort;

  // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å
  const hourlyRate = 50; // –ß–∞—Å–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞
  const developmentCost = totalEffort * hourlyRate;
  const testingHours = 80;
  const testingCost = testingHours * hourlyRate;
  const codeReviewHours = 40;
  const codeReviewCost = codeReviewHours * hourlyRate;
  const documentationHours = 20;
  const documentationCost = documentationHours * hourlyRate;
  const devOpsHours = 30;
  const devOpsCost = devOpsHours * hourlyRate;
  const totalHours = totalEffort + testingHours + codeReviewHours + documentationHours + devOpsHours;
  const totalCost = developmentCost + testingCost + codeReviewCost + documentationCost + devOpsCost;

  // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º ROI
  const technicalDebtHours = analysis.technicalDebt?.totalHours || 88;
  const technicalDebtCost = technicalDebtHours * hourlyRate;
  const roiPercent = analysis.technicalDebt?.roi || analysis.roi?.roiPercent || 400;
  const totalSavings = technicalDebtCost * (roiPercent / 100);

  return `
## üí∞ –≠–ö–û–ù–û–ú–ò–ß–ï–°–ö–û–ï –û–ë–û–°–ù–û–í–ê–ù–ò–ï

### –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏
| –°—Ç–∞—Ç—å—è | –ß–∞—Å—ã | –°—Ç–æ–∏–º–æ—Å—Ç—å |
|--------|------|-----------|
