<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EAP Analyzer - Dashboard Прогресса</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link href="css/styles.css" rel="stylesheet" />
  </head>
  <body>
    <!-- Header -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
      <div class="container-fluid">
        <a class="navbar-brand fw-bold" href="#">
          <i class="bi bi-bar-chart-line"></i>
          EAP Analyzer Dashboard
        </a>
        <div class="navbar-nav ms-auto d-flex flex-row align-items-center">
          <!-- Live Update Button -->
          <button
            id="live-update-btn"
            class="btn btn-outline-light btn-sm me-3"
            onclick="dashboard.refreshLiveData()"
            title="Обновить данные из live-отчета"
          >
            <i class="bi bi-arrow-clockwise"></i>
            <span class="d-none d-md-inline">Live Update</span>
          </button>

          <span class="navbar-text me-3">
            <small class="text-muted">Генерировать отчет:</small>
            <code
              class="bg-dark text-warning px-2 py-1 rounded ms-1"
              style="cursor: pointer; user-select: all"
              onclick="copyToClipboard('node live-generator.cjs')"
              title="Нажмите чтобы скопировать команду"
            >
              node live-generator.cjs
            </code>
          </span>
          <span class="navbar-text">
            <i class="bi bi-calendar3"></i>
            <span id="last-update">11.09.2025</span>
          </span>
        </div>
      </div>
    </nav>

    <!-- Controls -->
    <div class="container-fluid mt-3">
      <!-- Classification Section - Main Filter -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="card border-primary">
            <div
              class="card-header bg-primary bg-opacity-10 d-flex justify-content-between align-items-center"
            >
              <h5 class="mb-0 text-primary">
                <i class="bi bi-diagram-3"></i>
                Классификация компонентов по назначению
              </h5>
              <div class="form-check form-switch">
                <input
                  class="form-check-input"
                  type="checkbox"
                  role="switch"
                  id="analyzers-only-filter"
                />
                <label class="form-check-label fw-semibold" for="analyzers-only-filter">
                  Только анализаторы
                </label>
              </div>
            </div>
            <div class="card-body">
              <div class="alert alert-info mb-3" role="alert">
                <i class="bi bi-info-circle"></i>
                <strong>Главный фильтр:</strong> Выберите тип компонентов для отображения во всех
                разделах ниже
              </div>
              <div class="row">
                <!-- Analyzers Column -->
                <div class="col-md-4">
                  <div
                    class="border rounded p-3 h-100"
                    style="
                      border-color: #28a745 !important;
                      background-color: rgba(40, 167, 69, 0.05);
                    "
                  >
                    <div class="d-flex align-items-center mb-3">
                      <div
                        class="bg-success text-white rounded-circle d-flex align-items-center justify-content-center me-3"
                        style="width: 40px; height: 40px"
                      >
                        <i class="bi bi-search"></i>
                      </div>
                      <div>
                        <h6 class="mb-0 text-success">Анализаторы</h6>
                        <small class="text-muted">Анализируют другие проекты</small>
                      </div>
                    </div>
                    <div class="text-center mb-3">
                      <h2 class="text-success mb-0" id="analyzers-count">241</h2>
                      <small class="text-muted">компонентов</small>
                    </div>
                    <div class="small text-muted">
                      <div class="mb-1">• Analyzers, Checkers, Evaluators</div>
                      <div class="mb-1">• Компоненты анализа тестов</div>
                      <div>• Адаптеры внешних инструментов</div>
                    </div>
                  </div>
                </div>

                <!-- Auxiliary Column -->
                <div class="col-md-4">
                  <div
                    class="border rounded p-3 h-100"
                    style="
                      border-color: #6c757d !important;
                      background-color: rgba(108, 117, 125, 0.05);
                    "
                  >
                    <div class="d-flex align-items-center mb-3">
                      <div
                        class="bg-secondary text-white rounded-circle d-flex align-items-center justify-content-center me-3"
                        style="width: 40px; height: 40px"
                      >
                        <i class="bi bi-tools"></i>
                      </div>
                      <div>
                        <h6 class="mb-0 text-secondary">Вспомогательные</h6>
                        <small class="text-muted">Поддерживающие компоненты</small>
                      </div>
                    </div>
                    <div class="text-center mb-3">
                      <h2 class="text-secondary mb-0" id="auxiliary-count">114</h2>
                      <small class="text-muted">компонентов</small>
                    </div>
                    <div class="small text-muted">
                      <div class="mb-1">• Утилиты и константы</div>
                      <div class="mb-1">• Генераторы отчетов</div>
                      <div>• Инфраструктурные модули</div>
                    </div>
                  </div>
                </div>

                <!-- Other Column -->
                <div class="col-md-4">
                  <div
                    class="border rounded p-3 h-100"
                    style="
                      border-color: #6c757d !important;
                      background-color: rgba(108, 117, 125, 0.05);
                    "
                  >
                    <div class="d-flex align-items-center mb-3">
                      <div
                        class="bg-secondary text-white rounded-circle d-flex align-items-center justify-content-center me-3"
                        style="width: 40px; height: 40px"
                      >
                        <i class="bi bi-file-text"></i>
                      </div>
                      <div>
                        <h6 class="mb-0" style="color: #495057">Остальное</h6>
                        <small class="text-muted">Документация и конфиги</small>
                      </div>
                    </div>
                    <div class="text-center mb-3">
                      <h2 class="mb-0" style="color: #495057" id="tests-count">0</h2>
                      <small class="text-muted">файлов</small>
                    </div>
                    <div class="small text-muted">
                      <div class="mb-1">• Документация (.md)</div>
                      <div class="mb-1">• Конфигурации</div>
                      <div>• Прочие файлы</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Фильтры категорий -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="card">
            <div class="card-header bg-light">
              <h6 class="mb-0">
                <i class="bi bi-funnel"></i> Фильтр по категориям
                <small class="text-muted">(<span id="category-count">12</span> категорий)</small>
              </h6>
            </div>
            <div class="card-body p-3">
              <div class="d-flex gap-2 flex-wrap" id="category-filters">
                <button
                  class="btn btn-primary active"
                  data-category="all"
                  title="Показать все компоненты"
                >
                  <i class="bi bi-grid-3x3-gap"></i> Все
                </button>
                <button
                  class="btn btn-outline-success"
                  data-category="testing"
                  title="Тестирование и контроль качества"
                >
                  <i class="bi bi-check-circle"></i> Testing
                </button>
                <button
                  class="btn btn-outline-danger"
                  data-category="security"
                  title="Безопасность и анализ угроз"
                >
                  <i class="bi bi-shield-check"></i> Security
                </button>
                <button
                  class="btn btn-outline-warning"
                  data-category="performance"
                  title="Производительность и оптимизация"
                >
                  <i class="bi bi-speedometer2"></i> Performance
                </button>
                <button
                  class="btn btn-outline-info"
                  data-category="docker"
                  title="Контейнеризация и развертывание"
                >
                  <i class="bi bi-box"></i> Docker
                </button>
                <button
                  class="btn btn-outline-secondary"
                  data-category="dependencies"
                  title="Анализ зависимостей"
                >
                  <i class="bi bi-layers"></i> Dependencies
                </button>
                <button
                  class="btn btn-outline-primary"
                  data-category="logging"
                  title="Система логирования"
                >
                  <i class="bi bi-file-text"></i> Logging
                </button>
                <button
                  class="btn btn-outline-success"
                  data-category="cicd"
                  title="Непрерывная интеграция"
                >
                  <i class="bi bi-arrow-repeat"></i> CI/CD
                </button>
                <button
                  class="btn btn-outline-dark"
                  data-category="codequality"
                  title="Качество кода"
                >
                  <i class="bi bi-code-slash"></i> Code Quality
                </button>
                <button class="btn btn-outline-secondary" data-category="core" title="Ядро системы">
                  <i class="bi bi-gear"></i> Core
                </button>
                <button
                  class="btn btn-outline-danger"
                  data-category="ai"
                  title="Искусственный интеллект"
                >
                  <i class="bi bi-robot"></i> AI
                </button>
                <button
                  class="btn btn-outline-primary"
                  data-category="architecture"
                  title="Анализ архитектуры"
                >
                  <i class="bi bi-diagram-3"></i> Architecture
                </button>
                <button
                  class="btn btn-outline-secondary"
                  data-category="utils"
                  title="Утилиты и вспомогательные модули"
                >
                  <i class="bi bi-tools"></i> Utils
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Summary Cards & Controls -->
      <div class="row mb-4 align-items-end">
        <!-- Summary Cards -->
        <div class="col-lg-2 col-md-4 mb-3">
          <div class="card h-100 border-success">
            <div class="card-body text-center py-1">
              <i class="bi bi-collection text-success fs-4"></i>
              <h6 class="text-success mb-0" id="total-components">60+</h6>
              <small class="card-text text-muted">Всего компонентов</small>
            </div>
          </div>
        </div>
        <div class="col-lg-2 col-md-4 mb-3">
          <div class="card h-100 border-primary">
            <div class="card-body text-center py-1">
              <i class="bi bi-graph-up-arrow text-primary fs-4"></i>
              <h6 class="text-primary mb-0" id="avg-logic">79.2%</h6>
              <small class="card-text text-muted">Готовность логики</small>
            </div>
          </div>
        </div>
        <div class="col-lg-2 col-md-4 mb-3">
          <div class="card h-100 border-info">
            <div class="card-body text-center py-1">
              <i class="bi bi-gear text-info fs-4"></i>
              <h6 class="text-info mb-0" id="avg-functionality">74.8%</h6>
              <small class="card-text text-muted">Функциональность</small>
            </div>
          </div>
        </div>
        <!-- File Upload -->
        <div class="col-lg-6 col-md-12 mb-3">
          <div class="d-flex gap-3 align-items-center">
            <span class="text-muted fw-semibold">Загрузка отчетов:</span>
            <div class="input-group flex-grow-1">
              <span class="input-group-text">
                <i class="bi bi-upload"></i>
              </span>
              <input
                type="file"
                class="form-control"
                id="report-upload"
                accept=".md,.markdown"
                multiple
              />
            </div>
          </div>
        </div>
      </div>

      <!-- Main Content -->
      <div class="row">
        <!-- Category Overview -->
        <div class="col-xl-8 mb-4">
          <div class="card h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h5 class="mb-0">
                <i class="bi bi-bar-chart"></i>
                Обзор по категориям
              </h5>
              <div class="btn-group btn-group-sm" role="group">
                <input type="radio" class="btn-check" name="chart-type" id="line-chart" checked />
                <label class="btn btn-outline-secondary" for="line-chart">
                  <i class="bi bi-graph-up"></i>
                </label>
                <input type="radio" class="btn-check" name="chart-type" id="bar-chart" />
                <label class="btn btn-outline-secondary" for="bar-chart">
                  <i class="bi bi-bar-chart"></i>
                </label>
              </div>
            </div>
            <div class="card-body">
              <canvas id="categories-chart" height="300"></canvas>
            </div>
          </div>
        </div>

        <!-- Right Sidebar with Top/Bottom Components -->
        <div class="col-xl-4 mb-4">
          <div class="row">
            <!-- Top Components -->
            <div class="col-6">
              <div class="card h-100">
                <div class="card-header bg-success text-white py-2">
                  <h6 class="mb-0 small">
                    <i class="bi bi-award"></i>
                    🏆 Топ-10
                  </h6>
                </div>
                <div class="card-body py-2" style="max-height: 400px; overflow-y: auto">
                  <div id="top-components-list">
                    <!-- Будет заполнено JavaScript -->
                  </div>
                </div>
              </div>
            </div>

            <!-- Bottom Components -->
            <div class="col-6">
              <div class="card h-100">
                <div class="card-header bg-warning text-dark py-2">
                  <h6 class="mb-0 small">
                    <i class="bi bi-exclamation-triangle"></i>
                    🔧 Доработка
                  </h6>
                </div>
                <div class="card-body py-2" style="max-height: 400px; overflow-y: auto">
                  <div id="bottom-components-list">
                    <!-- Будет заполнено JavaScript -->
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Detailed Components View -->
      <div class="row">
        <div class="col-12">
          <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h5 class="mb-0">
                <i class="bi bi-list-task"></i>
                Детальный анализ компонентов
                <span id="total-components-count">356</span>
                <small id="filter-status" class="text-muted ms-2"></small>
              </h5>
              <div class="btn-group btn-group-sm">
                <button class="btn btn-outline-primary" id="sort-by-name">
                  <i class="bi bi-sort-alpha-down"></i> По названию
                </button>
                <button class="btn btn-outline-success" id="sort-by-readiness">
                  <i class="bi bi-sort-numeric-down"></i> По готовности
                </button>
                <button class="btn btn-outline-info active" id="sort-by-category">
                  <i class="bi bi-collection"></i> По категориям
                </button>
              </div>
            </div>
            <div class="card-body p-0">
              <div class="table-responsive">
                <table class="table table-striped table-hover mb-0">
                  <thead class="table-dark sticky-top">
                    <tr>
                      <th width="20%">Название</th>
                      <th width="15%">Скрипт</th>
                      <th width="30%">Что делает</th>
                      <th width="12%">Логика</th>
                      <th width="12%">Функциональность</th>
                      <th width="11%">Количество тестов</th>
                    </tr>
                  </thead>
                  <tbody id="components-table-body">
                    <!-- Будет заполнено JavaScript -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Progress Timeline -->
      <div class="row mt-4">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="bi bi-clock-history"></i>
                Временная шкала развития
              </h5>
            </div>
            <div class="card-body">
              <canvas id="timeline-chart" height="200"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="bg-light text-center py-3 mt-5">
      <div class="container">
        <small class="text-muted">
          EAP Analyzer Dashboard © 2025 | Последнее обновление:
          <span id="footer-update">11.09.2025</span>
        </small>
      </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Chart.js с callback для инициализации -->
    <script>
      // Загружаем Chart.js и ждем его готовности
      const chartScript = document.createElement('script');
      chartScript.src = 'https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js';
      chartScript.crossOrigin = 'anonymous';
      chartScript.onload = function () {
        // Chart.js успешно загружен
        if (typeof Chart !== 'undefined') {
          loadDashboardScripts();
        } else {
          console.error('❌ Chart не стал доступным после загрузки');
        }
      };
      chartScript.onerror = function () {
        console.error('❌ Ошибка загрузки Chart.js, пробуем альтернативный способ');

        // Пробуем загрузить альтернативную версию
        const fallbackScript = document.createElement('script');
        fallbackScript.src = 'https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js';
        fallbackScript.onload = function () {
          // Chart.js fallback загружен
          if (typeof Chart !== 'undefined') {
            loadDashboardScripts();
          } else {
            console.error('❌ Fallback Chart.js также недоступен');
            loadDashboardScripts(); // загружаем остальное без Chart.js
          }
        };
        fallbackScript.onerror = function () {
          console.error('❌ Fallback Chart.js также не загрузился');
          loadDashboardScripts(); // продолжаем без Chart.js
        };
        document.head.appendChild(fallbackScript);
      };
      document.head.appendChild(chartScript);

      // Функция загрузки dashboard скриптов
      function loadDashboardScripts() {
        const timestamp = new Date().getTime();
        const scripts = [
          `data/data.js?v=${timestamp}`,
          `js/components.js?v=${timestamp}`,
          `js/parser.js?v=${timestamp}`,
          `js/charts.js?v=${timestamp}`,
          `js/dashboard.js?v=${timestamp}`,
        ];

        let loadedScripts = 0;

        scripts.forEach((src, index) => {
          const script = document.createElement('script');
          script.src = src;
          script.onload = function () {
            loadedScripts++;
            // Модуль загружен
            if (loadedScripts === scripts.length) {
              initializeDashboard();
            }
          };
          script.onerror = function () {
            console.error(`❌ Ошибка загрузки: ${src}`);
          };
          document.head.appendChild(script);
        });
      }

      // Инициализация dashboard
      function initializeDashboard() {
        // Проверяем готовность всех компонентов
        if (typeof Chart === 'undefined') {
          console.error('❌ Chart.js не доступен');
          return;
        }

        if (typeof EAP_DATA === 'undefined') {
          console.error('❌ EAP_DATA не доступен');
          return;
        }

        if (typeof EAPDashboard === 'undefined') {
          console.error('❌ EAPDashboard не доступен');
          return;
        }

        // Инициализация Dashboard...

        setTimeout(() => {
          try {
            const dashboard = new EAPDashboard();
            const charts = new EAPChartsManager();

            // Делаем объекты доступными глобально
            window.EAPCharts = charts;
            window.dashboardInstance = dashboard;

            // Инициализируем dashboard
            dashboard.initialize();

            // Инициализируем классификацию
            initializeClassification();

            // Dashboard инициализирован
          } catch (error) {
            console.error('❌ Ошибка инициализации Dashboard:', error);
          }
        }, 100);
      }

      // Инициализация классификации
      function initializeClassification() {
        // Инициализация классификации...

        // Проверяем наличие данных классификации
        if (typeof EAP_DATA !== 'undefined' && EAP_DATA.classification) {
          // Данные классификации найдены

          const classification = EAP_DATA.classification;
          const counts = {
            analyzers: classification.stats?.analyzersCount || 0,
            auxiliary: classification.stats?.auxiliaryCount || 0,
            other: classification.stats?.otherCount || 0,
          };

          // Счетчики обновлены

          // Обновляем счетчики в UI
          const analyzersElement = document.getElementById('analyzers-count');
          const auxiliaryElement = document.getElementById('auxiliary-count');
          const testsElement = document.getElementById('tests-count');

          if (analyzersElement) analyzersElement.textContent = counts.analyzers;
          if (auxiliaryElement) auxiliaryElement.textContent = counts.auxiliary;
          if (testsElement) testsElement.textContent = counts.other;

          // Счетчики классификации обновлены
        } else {
          console.warn('⚠️ Данные классификации не найдены в EAP_DATA');
        }

        // Сохраняем данные классификации для использования в фильтрации
        if (EAP_DATA.classification) {
          window.classificationData = {
            analyzers: new Set(EAP_DATA.classification.analyzers),
            auxiliary: new Set(EAP_DATA.classification.auxiliary),
            other: new Set(EAP_DATA.classification.other),
          };
          // Данные классификации сохранены

          // Присваиваем классификацию всем компонентам
          assignClassificationToComponents();
        }

        // Обработчик переключателя "Только анализаторы"
        const filterToggle = document.getElementById('analyzers-only-filter');

        if (filterToggle) {
          // Добавляем обработчики событий для переключателя
          filterToggle.addEventListener('click', function (e) {
            // Клик обработан
          });

          filterToggle.addEventListener('input', function (e) {
            // Input событие обработано
          });

          filterToggle.addEventListener('change', function () {
            const showOnlyAnalyzers = this.checked;

            // Сбрасываем активные карточки, если переключатель сброшен
            if (!showOnlyAnalyzers) {
              resetActiveCards();
            } else {
              // Если включены только анализаторы, выделяем карточку анализаторов
              setActiveCard('analyzer-card');
            }

            // Применяем фильтрацию через Dashboard
            if (window.dashboardInstance) {
              window.dashboardInstance.currentClassificationFilter = showOnlyAnalyzers
                ? 'analyzer'
                : 'all';
              window.dashboardInstance.renderComponentsList();
              window.dashboardInstance.updateCategoryCounters();
              window.dashboardInstance.renderTopComponents();
              window.dashboardInstance.renderBottomComponents();

              // Обновляем диаграммы
              if (window.EAPCharts && window.EAPCharts.updateCategoriesChart) {
                window.EAPCharts.updateCategoriesChart();
              }

              // Показываем уведомление
              if (showOnlyAnalyzers) {
                showNotification(`Отображаются только анализаторы (241 компонентов)`, 'info');
              } else {
                showNotification('Отображаются все компоненты (356 компонентов)', 'info');
              }
            } else {
              // Резервный вариант - прямая фильтрация DOM
              filterComponents(showOnlyAnalyzers);

              // Показываем уведомление
              if (showOnlyAnalyzers) {
                showNotification(
                  `Отображаются только анализаторы (${document.getElementById('analyzers-count').textContent} компонентов)`,
                  'info'
                );
              } else {
                showNotification('Отображаются все компоненты', 'info');
              }
            }

            // Обработка события завершена
          });
        } else {
          console.error('❌ Переключатель analyzers-only-filter не найден!');
        }

        // Инициализируем кликабельные карточки классификации
        makeClassificationCardsClickable();
      }

      // Присваивание классификации компонентам
      function assignClassificationToComponents() {
        if (!window.EAP_DATA?.components || !window.classificationData) return;

        Object.keys(window.EAP_DATA.components).forEach(componentName => {
          const component = window.EAP_DATA.components[componentName];

          // Определяем тип компонента
          if (window.classificationData.analyzers.has(componentName)) {
            component.classification = 'analyzer';
          } else if (window.classificationData.other.has(componentName)) {
            component.classification = 'other';
          } else {
            component.classification = 'auxiliary';
          }
        });

        // Классификация присвоена всем компонентам
      }

      // Фильтрация компонентов
      function filterComponents(showOnlyAnalyzers) {
        // Получаем строки таблицы компонентов
        const componentRows = document.querySelectorAll(
          '#components-table-body tr[data-component-name]'
        );
        let visibleCount = 0;

        if (!window.classificationData) {
          console.warn('⚠️ Данные классификации не загружены, фильтрация невозможна');
          return;
        }

        componentRows.forEach(row => {
          const componentName = row.getAttribute('data-component-name');

          // Определяем тип компонента
          let componentType = 'auxiliary'; // по умолчанию
          if (window.classificationData.analyzers.has(componentName)) {
            componentType = 'analyzer';
          } else if (window.classificationData.other.has(componentName)) {
            componentType = 'other';
          }

          // Добавляем атрибут классификации для будущего использования
          row.setAttribute('data-component-classification', componentType);

          const shouldShow = !showOnlyAnalyzers || componentType === 'analyzer';

          if (shouldShow) {
            row.style.display = '';
            visibleCount++;
          } else {
            row.style.display = 'none';
          }
        });

        console.log(`📊 Отображено компонентов: ${visibleCount} из ${componentRows.length}`);

        // Обновляем счетчик отображаемых компонентов
        const totalElement = document.querySelector('#total-components-count');
        const filterStatusElement = document.querySelector('#filter-status');

        if (totalElement) {
          totalElement.textContent = visibleCount;
        }

        // Обновляем статус фильтрации
        if (filterStatusElement) {
          if (showOnlyAnalyzers) {
            filterStatusElement.textContent = '(только анализаторы)';
            filterStatusElement.className = 'text-success ms-2';
          } else {
            filterStatusElement.textContent = '(все компоненты)';
            filterStatusElement.className = 'text-muted ms-2';
          }
        }
      }

      // Уведомления
      function showNotification(message, type = 'info') {
        const alertClass = type === 'info' ? 'alert-info' : 'alert-success';
        const notification = document.createElement('div');
        notification.className = `alert ${alertClass} alert-dismissible fade show position-fixed`;
        notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; max-width: 300px;';
        notification.innerHTML = `
          ${message}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;

        document.body.appendChild(notification);

        // Автоматическое скрытие через 3 секунды
        setTimeout(() => {
          if (notification.parentNode) {
            notification.remove();
          }
        }, 3000);
      }

      // Функция для создания кликабельных карточек классификации
      function makeClassificationCardsClickable() {
        // Находим карточки классификации по их CSS селекторам
        const analyzerCard = document.querySelector('.col-md-4:nth-child(1) .border.rounded');
        const auxiliaryCard = document.querySelector('.col-md-4:nth-child(2) .border.rounded');
        const testsCard = document.querySelector('.col-md-4:nth-child(3) .border.rounded');

        if (!analyzerCard || !auxiliaryCard || !testsCard) {
          console.error('❌ Не удалось найти карточки классификации');
          return;
        }

        // Карточки классификации найдены

        // Добавляем стили и ID для кликабельности
        const cards = [
          { element: analyzerCard, id: 'analyzer-card', filter: 'analyzer' },
          { element: auxiliaryCard, id: 'auxiliary-card', filter: 'auxiliary' },
          { element: testsCard, id: 'tests-card', filter: 'test' },
        ];

        cards.forEach(({ element, id, filter }) => {
          element.id = id;
          element.style.cursor = 'pointer';
          element.style.transition = 'all 0.2s ease';
          element.title = 'Нажмите для фильтрации по этому типу компонентов';

          // Эффект при наведении
          element.addEventListener('mouseover', () => {
            element.style.transform = 'translateY(-3px)';
            element.style.boxShadow = '0 8px 25px rgba(0,0,0,0.15)';
            element.style.opacity = '0.95';
          });

          element.addEventListener('mouseout', () => {
            if (!element.classList.contains('active-filter')) {
              element.style.transform = 'translateY(0)';
              element.style.boxShadow = 'none';
              element.style.opacity = '1';
            }
          });
        });

        // Обработчик клика для карточки анализаторов
        analyzerCard.addEventListener('click', () => {
          // Устанавливаем переключатель "Только анализаторы"
          const toggle = document.getElementById('analyzers-only-filter');
          if (toggle) {
            toggle.checked = true;
            toggle.dispatchEvent(new Event('change'));
          }

          // Устанавливаем фильтр классификации
          if (window.dashboardInstance) {
            window.dashboardInstance.currentClassificationFilter = 'analyzer';
            window.dashboardInstance.renderComponentsList();
            window.dashboardInstance.updateCategoryCounters();
            window.dashboardInstance.renderTopComponents();
            window.dashboardInstance.renderBottomComponents();

            // Обновляем диаграммы
            if (window.EAPCharts && window.EAPCharts.updateCategoriesChart) {
              window.EAPCharts.updateCategoriesChart();
            }
          }

          // Применяем стили активной карточки
          setActiveCard('analyzer-card');
          showNotification('Отображаются только анализаторы (206 компонентов)', 'info');
        });

        // Обработчик клика для карточки вспомогательных
        auxiliaryCard.addEventListener('click', () => {
          // Сбрасываем переключатель "Только анализаторы"
          const toggle = document.getElementById('analyzers-only-filter');
          if (toggle) {
            toggle.checked = false;
          }

          // Устанавливаем фильтр на вспомогательные компоненты
          if (window.dashboardInstance) {
            window.dashboardInstance.currentClassificationFilter = 'auxiliary';
            window.dashboardInstance.renderComponentsList();
            window.dashboardInstance.updateCategoryCounters();
            window.dashboardInstance.renderTopComponents();
            window.dashboardInstance.renderBottomComponents();

            // Обновляем диаграммы
            if (window.EAPCharts && window.EAPCharts.updateCategoriesChart) {
              window.EAPCharts.updateCategoriesChart();
            }
          }

          // Применяем стили активной карточки
          setActiveCard('auxiliary-card');
          showNotification(
            'Отображаются только вспомогательные компоненты (76 компонентов)',
            'info'
          );
        });

        // Обработчик клика для карточки тестовых
        testsCard.addEventListener('click', () => {
          // Сбрасываем переключатель "Только анализаторы"
          const toggle = document.getElementById('analyzers-only-filter');
          if (toggle) {
            toggle.checked = false;
          }

          // Устанавливаем фильтр на остальные компоненты
          if (window.dashboardInstance) {
            window.dashboardInstance.currentClassificationFilter = 'other';
            window.dashboardInstance.renderComponentsList();
            window.dashboardInstance.updateCategoryCounters();
            window.dashboardInstance.renderTopComponents();
            window.dashboardInstance.renderBottomComponents();

            // Обновляем диаграммы
            if (window.EAPCharts && window.EAPCharts.updateCategoriesChart) {
              window.EAPCharts.updateCategoriesChart();
            }
          }

          // Применяем стили активной карточки
          setActiveCard('tests-card');
          showNotification('Отображаются остальные компоненты (74 файла)', 'info');
        });

        // Карточки классификации стали кликабельными
      }

      // Функция для выделения активной карточки
      function setActiveCard(activeCardId) {
        const cards = ['analyzer-card', 'auxiliary-card', 'tests-card'];

        cards.forEach(cardId => {
          const card = document.getElementById(cardId);
          if (card) {
            if (cardId === activeCardId) {
              card.classList.add('active-filter');
              card.style.transform = 'translateY(-3px)';
              card.style.boxShadow = '0 8px 25px rgba(0,0,0,0.2)';
              card.style.opacity = '1';
              card.style.border = '2px solid #007bff !important';
            } else {
              card.classList.remove('active-filter');
              card.style.transform = 'translateY(0)';
              card.style.boxShadow = 'none';
              card.style.opacity = '1';
              card.style.border = '';
            }
          }
        });
      }

      // Функция для сброса всех активных карточек
      function resetActiveCards() {
        const cards = ['analyzer-card', 'auxiliary-card', 'tests-card'];
        cards.forEach(cardId => {
          const card = document.getElementById(cardId);
          if (card) {
            card.classList.remove('active-filter');
            card.style.transform = 'translateY(0)';
            card.style.boxShadow = 'none';
            card.style.opacity = '1';
            card.style.border = '';
          }
        });
      }
    </script>

    <!-- Copy to clipboard function -->
    <script>
      function copyToClipboard(text) {
        navigator.clipboard
          .writeText(text)
          .then(function () {
            // Show success tooltip
            const tooltip = document.createElement('div');
            tooltip.className = 'alert alert-success position-fixed';
            tooltip.style.cssText =
              'top: 20px; right: 20px; z-index: 9999; animation: fadeInOut 2s forwards;';
            tooltip.innerHTML =
              '<i class="bi bi-check-circle"></i> Команда скопирована в буфер обмена!';
            document.body.appendChild(tooltip);

            setTimeout(() => {
              if (tooltip.parentNode) {
                tooltip.parentNode.removeChild(tooltip);
              }
            }, 2000);
          })
          .catch(function (err) {
            console.error('Ошибка копирования: ', err);
            alert('Команда: ' + text);
          });
      }
    </script>

    <!-- CSS for fade animation -->
    <style>
      @keyframes fadeInOut {
        0% {
          opacity: 0;
          transform: translateX(100%);
        }
        20% {
          opacity: 1;
          transform: translateX(0);
        }
        80% {
          opacity: 1;
          transform: translateX(0);
        }
        100% {
          opacity: 0;
          transform: translateX(100%);
        }
      }
    </style>
  </body>
</html>
