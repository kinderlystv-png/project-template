<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EAP Analyzer - Dashboard –ü—Ä–æ–≥—Ä–µ—Å—Å–∞</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link href="css/styles.css" rel="stylesheet" />
  </head>
  <body>
    <!-- Header -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
      <div class="container-fluid">
        <a class="navbar-brand fw-bold" href="#">
          <i class="bi bi-bar-chart-line"></i>
          EAP Analyzer Dashboard
        </a>
        <div class="navbar-nav ms-auto d-flex flex-row align-items-center">
          <!-- Live Update Button -->
          <button
            id="live-update-btn"
            class="btn btn-outline-light btn-sm me-3"
            onclick="dashboard.refreshLiveData()"
            title="–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ live-–æ—Ç—á–µ—Ç–∞"
          >
            <i class="bi bi-arrow-clockwise"></i>
            <span class="d-none d-md-inline">Live Update</span>
          </button>

          <span class="navbar-text me-3">
            <small class="text-muted">–ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á–µ—Ç:</small>
            <code
              class="bg-dark text-warning px-2 py-1 rounded ms-1"
              style="cursor: pointer; user-select: all"
              onclick="copyToClipboard('node live-generator.cjs')"
              title="–ù–∞–∂–º–∏—Ç–µ —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É"
            >
              node live-generator.cjs
            </code>
          </span>
          <span class="navbar-text">
            <i class="bi bi-calendar3"></i>
            <span id="last-update">11.09.2025</span>
          </span>
        </div>
      </div>
    </nav>

    <!-- Controls -->
    <div class="container-fluid mt-3">
      <!-- –§–∏–ª—å—Ç—Ä—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="card">
            <div class="card-header bg-light">
              <h6 class="mb-0">
                <i class="bi bi-funnel"></i> –§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
                <small class="text-muted">(<span id="category-count">12</span> –∫–∞—Ç–µ–≥–æ—Ä–∏–π)</small>
              </h6>
            </div>
            <div class="card-body p-3">
              <div class="d-flex gap-2 flex-wrap" id="category-filters">
                <button
                  class="btn btn-primary active"
                  data-category="all"
                  title="–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã"
                >
                  <i class="bi bi-grid-3x3-gap"></i> –í—Å–µ
                </button>
                <button
                  class="btn btn-outline-success"
                  data-category="testing"
                  title="–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –∫–∞—á–µ—Å—Ç–≤–∞"
                >
                  <i class="bi bi-check-circle"></i> Testing
                </button>
                <button
                  class="btn btn-outline-danger"
                  data-category="security"
                  title="–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∞–Ω–∞–ª–∏–∑ —É–≥—Ä–æ–∑"
                >
                  <i class="bi bi-shield-check"></i> Security
                </button>
                <button
                  class="btn btn-outline-warning"
                  data-category="performance"
                  title="–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è"
                >
                  <i class="bi bi-speedometer2"></i> Performance
                </button>
                <button
                  class="btn btn-outline-info"
                  data-category="docker"
                  title="–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ"
                >
                  <i class="bi bi-box"></i> Docker
                </button>
                <button
                  class="btn btn-outline-secondary"
                  data-category="dependencies"
                  title="–ê–Ω–∞–ª–∏–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π"
                >
                  <i class="bi bi-layers"></i> Dependencies
                </button>
                <button
                  class="btn btn-outline-primary"
                  data-category="logging"
                  title="–°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è"
                >
                  <i class="bi bi-file-text"></i> Logging
                </button>
                <button
                  class="btn btn-outline-success"
                  data-category="cicd"
                  title="–ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è"
                >
                  <i class="bi bi-arrow-repeat"></i> CI/CD
                </button>
                <button
                  class="btn btn-outline-dark"
                  data-category="codequality"
                  title="–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞"
                >
                  <i class="bi bi-code-slash"></i> Code Quality
                </button>
                <button class="btn btn-outline-secondary" data-category="core" title="–Ø–¥—Ä–æ —Å–∏—Å—Ç–µ–º—ã">
                  <i class="bi bi-gear"></i> Core
                </button>
                <button
                  class="btn btn-outline-danger"
                  data-category="ai"
                  title="–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç"
                >
                  <i class="bi bi-robot"></i> AI
                </button>
                <button
                  class="btn btn-outline-primary"
                  data-category="architecture"
                  title="–ê–Ω–∞–ª–∏–∑ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã"
                >
                  <i class="bi bi-diagram-3"></i> Architecture
                </button>
                <button
                  class="btn btn-outline-secondary"
                  data-category="utils"
                  title="–£—Ç–∏–ª–∏—Ç—ã –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏"
                >
                  <i class="bi bi-tools"></i> Utils
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª—ã -->
      <div class="row mb-4">
        <div class="col-md-8">
          <div class="d-flex gap-2 flex-wrap align-items-center">
            <span class="text-muted">–ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø:</span>
          </div>
        </div>
        <div class="col-md-4">
          <div class="input-group">
            <span class="input-group-text">
              <i class="bi bi-upload"></i>
            </span>
            <input
              type="file"
              class="form-control"
              id="report-upload"
              accept=".md,.markdown"
              multiple
            />
          </div>
        </div>
      </div>

      <!-- Summary Cards -->
      <div class="row mb-4">
        <div class="col-lg-3 col-md-6 mb-3">
          <div class="card h-100 border-success">
            <div class="card-body text-center">
              <i class="bi bi-collection text-success display-4"></i>
              <h3 class="text-success" id="total-components">60+</h3>
              <p class="card-text">–í—Å–µ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤</p>
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
          <div class="card h-100 border-primary">
            <div class="card-body text-center">
              <i class="bi bi-graph-up-arrow text-primary display-4"></i>
              <h3 class="text-primary" id="avg-logic">79.2%</h3>
              <p class="card-text">–°—Ä–µ–¥–Ω—è—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –ª–æ–≥–∏–∫–∏</p>
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
          <div class="card h-100 border-info">
            <div class="card-body text-center">
              <i class="bi bi-gear text-info display-4"></i>
              <h3 class="text-info" id="avg-functionality">74.8%</h3>
              <p class="card-text">–°—Ä–µ–¥–Ω—è—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å</p>
            </div>
          </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
          <div class="card h-100 border-warning">
            <div class="card-body text-center">
              <i class="bi bi-trophy text-warning display-4"></i>
              <h3 class="text-warning" id="top-component">EnhancedJest</h3>
              <p class="card-text">–¢–æ–ø –∫–æ–º–ø–æ–Ω–µ–Ω—Ç</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Content -->
      <div class="row">
        <!-- Category Overview -->
        <div class="col-xl-8 mb-4">
          <div class="card h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h5 class="mb-0">
                <i class="bi bi-bar-chart"></i>
                –û–±–∑–æ—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
              </h5>
              <div class="btn-group btn-group-sm" role="group">
                <input type="radio" class="btn-check" name="chart-type" id="line-chart" checked />
                <label class="btn btn-outline-secondary" for="line-chart">
                  <i class="bi bi-graph-up"></i>
                </label>
                <input type="radio" class="btn-check" name="chart-type" id="bar-chart" />
                <label class="btn btn-outline-secondary" for="bar-chart">
                  <i class="bi bi-bar-chart"></i>
                </label>
              </div>
            </div>
            <div class="card-body">
              <canvas id="categories-chart" height="300"></canvas>
            </div>
          </div>
        </div>

        <!-- Right Sidebar with Top/Bottom Components -->
        <div class="col-xl-4 mb-4">
          <div class="row">
            <!-- Top Components -->
            <div class="col-6">
              <div class="card h-100">
                <div class="card-header bg-success text-white py-2">
                  <h6 class="mb-0 small">
                    <i class="bi bi-award"></i>
                    üèÜ –¢–æ–ø-10
                  </h6>
                </div>
                <div class="card-body py-2" style="max-height: 400px; overflow-y: auto">
                  <div id="top-components-list">
                    <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ JavaScript -->
                  </div>
                </div>
              </div>
            </div>

            <!-- Bottom Components -->
            <div class="col-6">
              <div class="card h-100">
                <div class="card-header bg-warning text-dark py-2">
                  <h6 class="mb-0 small">
                    <i class="bi bi-exclamation-triangle"></i>
                    üîß –î–æ—Ä–∞–±–æ—Ç–∫–∞
                  </h6>
                </div>
                <div class="card-body py-2" style="max-height: 400px; overflow-y: auto">
                  <div id="bottom-components-list">
                    <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ JavaScript -->
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Detailed Components View -->
      <div class="row">
        <div class="col-12">
          <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h5 class="mb-0">
                <i class="bi bi-list-task"></i>
                –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (<span id="total-components-count">60</span>)
              </h5>
              <div class="btn-group btn-group-sm">
                <button class="btn btn-outline-primary" id="sort-by-name">
                  <i class="bi bi-sort-alpha-down"></i> –ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é
                </button>
                <button class="btn btn-outline-success" id="sort-by-readiness">
                  <i class="bi bi-sort-numeric-down"></i> –ü–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
                </button>
                <button class="btn btn-outline-info active" id="sort-by-category">
                  <i class="bi bi-collection"></i> –ü–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
                </button>
              </div>
            </div>
            <div class="card-body p-0">
              <div class="table-responsive">
                <table class="table table-striped table-hover mb-0">
                  <thead class="table-dark sticky-top">
                    <tr>
                      <th width="20%">–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                      <th width="15%">–°–∫—Ä–∏–ø—Ç</th>
                      <th width="30%">–ß—Ç–æ –¥–µ–ª–∞–µ—Ç</th>
                      <th width="12%">–õ–æ–≥–∏–∫–∞</th>
                      <th width="12%">–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å</th>
                      <th width="11%">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤</th>
                    </tr>
                  </thead>
                  <tbody id="components-table-body">
                    <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ JavaScript -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Progress Timeline -->
      <div class="row mt-4">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">
                <i class="bi bi-clock-history"></i>
                –í—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞ —Ä–∞–∑–≤–∏—Ç–∏—è
              </h5>
            </div>
            <div class="card-body">
              <canvas id="timeline-chart" height="200"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="bg-light text-center py-3 mt-5">
      <div class="container">
        <small class="text-muted">
          EAP Analyzer Dashboard ¬© 2025 | –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:
          <span id="footer-update">11.09.2025</span>
        </small>
      </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Chart.js —Å callback –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ -->
    <script>
      // –ó–∞–≥—Ä—É–∂–∞–µ–º Chart.js –∏ –∂–¥–µ–º –µ–≥–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
      const chartScript = document.createElement('script');
      chartScript.src = 'https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js';
      chartScript.crossOrigin = 'anonymous';
      chartScript.onload = function () {
        console.log('üìä Chart.js –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ');
        console.log('Chart –¥–æ—Å—Ç—É–ø–µ–Ω:', typeof Chart !== 'undefined');
        if (typeof Chart !== 'undefined') {
          loadDashboardScripts();
        } else {
          console.error('‚ùå Chart –Ω–µ —Å—Ç–∞–ª –¥–æ—Å—Ç—É–ø–Ω—ã–º –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏');
        }
      };
      chartScript.onerror = function () {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ Chart.js, –ø—Ä–æ–±—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–±');

        // –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—É—é –≤–µ—Ä—Å–∏—é
        const fallbackScript = document.createElement('script');
        fallbackScript.src = 'https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js';
        fallbackScript.onload = function () {
          console.log('üìä Chart.js v3.9.1 –∑–∞–≥—Ä—É–∂–µ–Ω –∫–∞–∫ fallback');
          if (typeof Chart !== 'undefined') {
            loadDashboardScripts();
          } else {
            console.error('‚ùå Fallback Chart.js —Ç–∞–∫–∂–µ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
            loadDashboardScripts(); // –∑–∞–≥—Ä—É–∂–∞–µ–º –æ—Å—Ç–∞–ª—å–Ω–æ–µ –±–µ–∑ Chart.js
          }
        };
        fallbackScript.onerror = function () {
          console.error('‚ùå Fallback Chart.js —Ç–∞–∫–∂–µ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è');
          loadDashboardScripts(); // –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ Chart.js
        };
        document.head.appendChild(fallbackScript);
      };
      document.head.appendChild(chartScript);

      // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ dashboard —Å–∫—Ä–∏–ø—Ç–æ–≤
      function loadDashboardScripts() {
        const timestamp = new Date().getTime();
        const scripts = [
          `js/components.js?v=${timestamp}`,
          `js/parser.js?v=${timestamp}`,
          `js/charts.js?v=${timestamp}`,
          `js/dashboard.js?v=${timestamp}`,
        ];

        let loadedScripts = 0;

        scripts.forEach((src, index) => {
          const script = document.createElement('script');
          script.src = src;
          script.onload = function () {
            loadedScripts++;
            console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω: ${src}`);
            if (loadedScripts === scripts.length) {
              initializeDashboard();
            }
          };
          script.onerror = function () {
            console.error(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${src}`);
          };
          document.head.appendChild(script);
        });
      }

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è dashboard
      function initializeDashboard() {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
        if (typeof Chart === 'undefined') {
          console.error('‚ùå Chart.js –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω');
          return;
        }

        if (typeof EAP_DATA === 'undefined') {
          console.error('‚ùå EAP_DATA –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω');
          return;
        }

        if (typeof EAPDashboard === 'undefined') {
          console.error('‚ùå EAPDashboard –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω');
          return;
        }

        console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Dashboard...');

        setTimeout(() => {
          try {
            const dashboard = new EAPDashboard();
            const charts = new EAPChartsManager();

            // –î–µ–ª–∞–µ–º charts –¥–æ—Å—Ç—É–ø–Ω—ã–º –≥–ª–æ–±–∞–ª—å–Ω–æ
            window.EAPCharts = charts;

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º dashboard
            dashboard.initialize();
            console.log('‚úÖ Dashboard –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ');
          } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Dashboard:', error);
          }
        }, 100);
      }
    </script>

    <!-- Copy to clipboard function -->
    <script>
      function copyToClipboard(text) {
        navigator.clipboard
          .writeText(text)
          .then(function () {
            // Show success tooltip
            const tooltip = document.createElement('div');
            tooltip.className = 'alert alert-success position-fixed';
            tooltip.style.cssText =
              'top: 20px; right: 20px; z-index: 9999; animation: fadeInOut 2s forwards;';
            tooltip.innerHTML =
              '<i class="bi bi-check-circle"></i> –ö–æ–º–∞–Ω–¥–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!';
            document.body.appendChild(tooltip);

            setTimeout(() => {
              if (tooltip.parentNode) {
                tooltip.parentNode.removeChild(tooltip);
              }
            }, 2000);
          })
          .catch(function (err) {
            console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ', err);
            alert('–ö–æ–º–∞–Ω–¥–∞: ' + text);
          });
      }
    </script>

    <!-- CSS for fade animation -->
    <style>
      @keyframes fadeInOut {
        0% {
          opacity: 0;
          transform: translateX(100%);
        }
        20% {
          opacity: 1;
          transform: translateX(0);
        }
        80% {
          opacity: 1;
          transform: translateX(0);
        }
        100% {
          opacity: 0;
          transform: translateX(100%);
        }
      }
    </style>
  </body>
</html>
