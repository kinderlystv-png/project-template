# PHASE 5.2.2 - –ê–ù–ê–õ–ò–ó –¢–†–ï–ë–û–í–ê–ù–ò–ô
# –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ XSS/CSRF/–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

## 1. –°–¢–†–£–ö–¢–£–†–ò–†–û–í–ê–ù–ò–ï –ó–ê–î–ê–ß

### üéØ –§–ê–ó–ê 1: XSS –∏ CSRF –ê–Ω–∞–ª–∏–∑ (6 –¥–Ω–µ–π)
**–¶–µ–ª—å:** –î–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–µ–∫—Ü–∏—é –≤–µ–±-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π

#### –ó–∞–¥–∞—á–∞ 1.1: XSS Detection Engine (2 –¥–Ω—è)
**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ü–µ–ª—å:** –°–æ–∑–¥–∞—Ç—å –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –¥–ª—è –ø–æ–∏—Å–∫–∞ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π XSS
- ‚úÖ –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ HTML/Svelte —Ñ–∞–π–ª–æ–≤ –Ω–∞ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –≤—ã–≤–æ–¥—ã
- ‚úÖ –î–µ—Ç–µ–∫—Ü–∏—è `{@html}` –±–µ–∑ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–∏
- ‚úÖ –ü–æ–∏—Å–∫ `innerHTML`, `outerHTML` –ø—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏–π
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ —à–∞–±–ª–æ–Ω–∞—Ö

#### –ó–∞–¥–∞—á–∞ 1.2: CSRF Protection Checker (2 –¥–Ω—è)
**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ü–µ–ª—å:** –ê–Ω–∞–ª–∏–∑ –∑–∞—â–∏—Ç—ã –æ—Ç CSRF –∞—Ç–∞–∫
- ‚úÖ –ü–æ–∏—Å–∫ —Ñ–æ—Ä–º –±–µ–∑ CSRF —Ç–æ–∫–µ–Ω–æ–≤
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ API endpoints –Ω–∞ CSRF middleware
- ‚úÖ –ê–Ω–∞–ª–∏–∑ SvelteKit —Ñ–æ—Ä–º –∏ actions
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è SameSite cookie –Ω–∞—Å—Ç—Ä–æ–µ–∫

#### –ó–∞–¥–∞—á–∞ 1.3: Integration & Templates (2 –¥–Ω—è)
**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ü–µ–ª—å:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å RecommendationEngine
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ WebSecurityFixTemplates
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ SecurityChecker
- ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

### üîê –§–ê–ó–ê 2: Authentication & Authorization (8 –¥–Ω–µ–π)
**–¶–µ–ª—å:** –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

#### –ó–∞–¥–∞—á–∞ 2.1: Auth Flow Analysis (3 –¥–Ω—è)
**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ü–µ–ª—å:** –ê–Ω–∞–ª–∏–∑ –ø–æ—Ç–æ–∫–æ–≤ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- ‚úÖ –ü–æ–∏—Å–∫ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ JWT —Ç–æ–∫–µ–Ω–æ–≤ (—Å–µ–∫—Ä–µ—Ç—ã, –∞–ª–≥–æ—Ä–∏—Ç–º—ã)
- ‚úÖ –ê–Ω–∞–ª–∏–∑ session —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ logout –ø—Ä–æ—Ü–µ–¥—É—Ä

#### –ó–∞–¥–∞—á–∞ 2.2: Authorization Checks (3 –¥–Ω—è)
**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ü–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- ‚úÖ –ê–Ω–∞–ª–∏–∑ middleware –¥–ª—è –∑–∞—â–∏—Ç—ã —Ä–æ—É—Ç–æ–≤
- ‚úÖ –ü–æ–∏—Å–∫ IDOR —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª—å-based –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è API –∑–∞—â–∏—Ç—ã

#### –ó–∞–¥–∞—á–∞ 2.3: Security Headers & Final Integration (2 –¥–Ω—è)
**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ü–µ–ª—å:** –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ security headers (CSP, HSTS, etc)
- ‚úÖ –§–∏–Ω–∞–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- ‚úÖ –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –ø—Ä–∏–º–µ—Ä—ã

---

## 2. –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ô –ê–ù–ê–õ–ò–ó

### üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Ñ–∞–π–ª—ã

```
eap-analyzer/src/checkers/security/
‚îú‚îÄ‚îÄ SecurityChecker.ts              # ‚úÖ –ì–ª–∞–≤–Ω—ã–π –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä
‚îú‚îÄ‚îÄ DependenciesSecurityChecker.ts  # ‚úÖ –°—É—â–µ—Å—Ç–≤—É–µ—Ç
‚îú‚îÄ‚îÄ CodeSecurityChecker.ts          # ‚úÖ –°—É—â–µ—Å—Ç–≤—É–µ—Ç
‚îú‚îÄ‚îÄ ConfigSecurityChecker.ts        # ‚úÖ –°—É—â–µ—Å—Ç–≤—É–µ—Ç
‚îú‚îÄ‚îÄ WebSecurityChecker.ts           # üÜï –ù–æ–≤—ã–π - XSS/CSRF/Auth
‚îî‚îÄ‚îÄ analyzers/
    ‚îú‚îÄ‚îÄ XSSAnalyzer.ts              # üÜï XSS –¥–µ—Ç–µ–∫—Ü–∏—è
    ‚îú‚îÄ‚îÄ CSRFAnalyzer.ts             # üÜï CSRF –ø—Ä–æ–≤–µ—Ä–∫–∏
    ‚îú‚îÄ‚îÄ AuthAnalyzer.ts             # üÜï –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
    ‚îî‚îÄ‚îÄ SecurityHeadersAnalyzer.ts  # üÜï HTTP –∑–∞–≥–æ–ª–æ–≤–∫–∏

src/recommendations/
‚îú‚îÄ‚îÄ RecommendationEngine.ts         # ‚úÖ –°—É—â–µ—Å—Ç–≤—É–µ—Ç
‚îú‚îÄ‚îÄ WebSecurityFixTemplates.ts      # üÜï –í–µ–±-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
‚îî‚îÄ‚îÄ types.ts                        # ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å —Ç–∏–ø—ã
```

### üîß –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

#### 1. WebSecurityChecker (–ì–ª–∞–≤–Ω—ã–π)
```typescript
export class WebSecurityChecker {
  private xssAnalyzer = new XSSAnalyzer();
  private csrfAnalyzer = new CSRFAnalyzer();
  private authAnalyzer = new AuthAnalyzer();

  async analyzeWebSecurity(context: CheckContext): Promise<WebSecurityResult>
}
```

#### 2. XSSAnalyzer
```typescript
export class XSSAnalyzer {
  async scanForXSS(context: CheckContext): Promise<XSSVulnerability[]>
  // –°–∫–∞–Ω–∏—Ä—É–µ—Ç: .svelte, .html, .js, .ts —Ñ–∞–π–ª—ã
  // –ò—â–µ—Ç: {@html}, innerHTML, –æ–ø–∞—Å–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
}
```

#### 3. CSRFAnalyzer
```typescript
export class CSRFAnalyzer {
  async checkCSRFProtection(context: CheckContext): Promise<CSRFIssue[]>
  // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç: —Ñ–æ—Ä–º—ã, API endpoints, middleware
  // –ü—Ä–æ–≤–µ—Ä—è–µ—Ç: CSRF —Ç–æ–∫–µ–Ω—ã, SameSite cookies
}
```

### üìä –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

```typescript
// –ù–æ–≤—ã–µ —Ç–∏–ø—ã –≤ types.ts
interface WebSecurityResult {
  xssVulnerabilities: XSSVulnerability[];
  csrfIssues: CSRFIssue[];
  authProblems: AuthProblem[];
  securityHeaders: SecurityHeaderIssue[];
}

interface XSSVulnerability {
  type: 'innerHTML' | 'htmlOutput' | 'urlParam';
  file: string;
  line: number;
  severity: 'critical' | 'high' | 'medium';
  context: string;
}
```

### üîå –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

**SecurityChecker.ts** - –¥–æ–±–∞–≤–∏—Ç—å WebSecurityChecker:
```typescript
// –í –º–µ—Ç–æ–¥–µ runSecurityAnalysis
const webSecurityResult = await this.webChecker.analyzeWebSecurity(context);
```

**RecommendationEngine.ts** - –¥–æ–±–∞–≤–∏—Ç—å –≤–µ–±-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
```typescript
// –í generateRecommendations
if (context.webSecurity) {
  recommendations.push(...WebSecurityFixTemplates.generateXSSFixes(xssIssues));
}
```

### üìö –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏
- **–ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ:** fs, path, glob –¥–ª—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤
- **–ü–∞—Ä—Å–∏–Ω–≥:** –ü—Ä–æ—Å—Ç—ã–µ regex –¥–ª—è –Ω–∞—á–∞–ª–∞, –ø–æ–∑–∂–µ AST –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
- **–ë–µ–∑ –Ω–æ–≤—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** - –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### ‚ö†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ (–±–µ–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–¥–∞)
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç (–±–µ–∑ runtime –¥–∞–Ω–Ω—ã—Ö)
- –í–æ–∑–º–æ–∂–Ω—ã false positives (–∫–æ–º–ø–µ–Ω—Å–∏—Ä—É–µ–º –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–µ–π)

---

## 3. –ö–†–ò–¢–ï–†–ò–ò –ü–†–ò–Å–ú–ö–ò

### ‚úÖ –£—Å–ª–æ–≤–∏—è —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**–§–∞–∑–∞ 1 (XSS/CSRF):**
- [ ] –ù–∞—Ö–æ–¥–∏—Ç XSS –≤ {@html} –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è—Ö
- [ ] –û–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç —Ñ–æ—Ä–º—ã –±–µ–∑ CSRF –∑–∞—â–∏—Ç—ã
- [ ] –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ RecommendationEngine

**–§–∞–∑–∞ 2 (Auth):**
- [ ] –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç JWT —Ç–æ–∫–µ–Ω—ã –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- [ ] –ù–∞—Ö–æ–¥–∏—Ç –ø—Ä–æ–±–ª–µ–º—ã –≤ —Å–∏—Å—Ç–µ–º–∞—Ö –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- [ ] –ü—Ä–æ–≤–µ—Ä—è–µ—Ç security headers
- [ ] –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å 75%+ (–∫–∞–∫ –≤ Phase 5.2.1)

### üß™ –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

1. **XSS Test:** –°–æ–∑–¥–∞—Ç—å .svelte —Ñ–∞–π–ª —Å `{@html userInput}` ‚Üí –¥–æ–ª–∂–µ–Ω –Ω–∞–π—Ç–∏ —É—è–∑–≤–∏–º–æ—Å—Ç—å
2. **CSRF Test:** –°–æ–∑–¥–∞—Ç—å —Ñ–æ—Ä–º—É –±–µ–∑ —Ç–æ–∫–µ–Ω–∞ ‚Üí –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–¥—É–ø—Ä–µ–¥–∏—Ç—å
3. **Auth Test:** JWT —Å weak secret ‚Üí –¥–æ–ª–∂–µ–Ω –Ω–∞–π—Ç–∏ –ø—Ä–æ–±–ª–µ–º—É
4. **Integration Test:** –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ ‚Üí 10+ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

### üìà –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

1. **–î–µ–Ω—å 2:** XSSAnalyzer —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –Ω–∞—Ö–æ–¥–∏—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏
2. **–î–µ–Ω—å 4:** CSRFAnalyzer –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –∏ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è
3. **–î–µ–Ω—å 7:** AuthAnalyzer –±–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –≥–æ—Ç–æ–≤–∞
4. **–î–µ–Ω—å 10:** –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ 75%+ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

### ‚ùì –í–æ–ø—Ä–æ—Å—ã –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è

1. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã:** –ö–∞–∫–∏–µ —Ç–∏–ø—ã XSS –∞—Ç–∞–∫ –≤–∞–∂–Ω–µ–µ –≤—Å–µ–≥–æ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞?
2. **CSRF:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–π CSRF middleware/–±–∏–±–ª–∏–æ—Ç–µ–∫–∞?
3. **Auth:** –ö–∞–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (JWT, sessions, custom)?

---

## üéØ –ò–¢–û–ì–û–í–ê–Ø –¶–ï–õ–¨
**–ü—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å SecurityChecker –∏–∑ "–±–∞–∑–æ–≤–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞" –≤ "—ç–∫—Å–ø–µ—Ä—Ç–Ω—É—é —Å–∏—Å—Ç–µ–º—É –≤–µ–±-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏"**

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—Ö–æ–¥–∏—Ç 80% —Ä–µ–∞–ª—å–Ω—ã—Ö –≤–µ–±-—É—è–∑–≤–∏–º–æ—Å—Ç–µ–π –∏ –¥–∞–µ—Ç –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é.

**–ü—Ä–∏–Ω—Ü–∏–ø –ü–∞—Ä–µ—Ç—Ç–æ:** –§–æ–∫—É—Å –Ω–∞ 3 —Å–∞–º—ã—Ö –æ–ø–∞—Å–Ω—ã—Ö —Ç–∏–ø–∞ –∞—Ç–∞–∫ (XSS, CSRF, Auth) = 80% –ø–æ–∫—Ä—ã—Ç–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.
